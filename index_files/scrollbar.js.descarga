if(typeof(SK)=='undefined')SK={};if(typeof(SK.UI)=='undefined')SK.UI={};SK.UI.Scrollbar=new Class({Implements:[Events,Options],constants:{CLASS_PREFIX:'sk-ui-scroll'},options:{horizontal:false,vertical:true,autohide:false,dynamic:true,buttons:false,track:false,mousewheel:true,replace_osx_native:false,prevent_position:false},el:{container:null,scroller:null},properties:{width:null,height:null},fns:{},scroller_drag:false,btn_multiplier:10,is_mobile:!!((navigator.userAgent+'').match(/(iPhone|iPad|iPod|android|htc|mobile)/i)),osx_version:((navigator.userAgent+'').match(/Mac OS X (10(?:\.|_)[789])/)||['',''])[1].replace('_','.').toFloat(),initialize:function(container,options){this.el.container=_$(container);this.setOptions(options);if(this.shouldApplyCustomScrollbar()){this.init();}},hasNativeOSXScrollers:function(){return this.is_mobile||this.osx_version>10.7||(this.osx_version&&['safari','chrome'].contains(Browser.name));},shouldApplyCustomScrollbar:function(){return!this.hasNativeOSXScrollers()||this.options.replace_osx_native;},init:function(){this.createBoundedFunctions();this.retrieveProperties();this.setStyles();this.createElements();this.initEvents();if(this.options.dynamic){this.initObserver();}},createBoundedFunctions:function(){this.fns={onButtonMouseDownHold:this.onButtonMouseDownHold.bind(this),hideScrollers:this.hideScrollers.bind(this),onDragStart:this.onDragStart.bind(this),onHorScrollerDrag:this.onHorScrollerDrag.bind(this),onVerScrollerDrag:this.onVerScrollerDrag.bind(this),onDragComplete:this.onDragComplete.bind(this),onClick:this.onClick.bind(this),onScroll:this.onScroll.bind(this),onMouseWheel:this.onMouseWheel.bind(this),onMouseOver:this.onMouseOver.bind(this),onMouseOut:this.onMouseOut.bind(this),onMouseDown:this.onMouseDown.bind(this),onMouseUp:this.onMouseUp.bind(this),empty:function(){}};},retrieveProperties:function(){this.properties.width=this.el.container.getWidth();this.properties.height=this.el.container.getHeight();this.properties.scrollWidth=this.el.container.scrollWidth;this.properties.scrollHeight=this.el.container.scrollHeight;},setStyles:function(){if(this.options.horizontal){this.el.container.setStyle('overflow-x','hidden');}
if(this.options.vertical){this.el.container.setStyle('overflow-y','hidden');}},createElements:function(){this.createWrapper();this.injectWrapper();this.createHolder();if(this.options.track){this.createTracks();}
this.createScrollers();this.updateScrollers();if(this.options.buttons){this.createButtons();}},createWrapper:function(){this.el.wrapper=new Element('div',{'class':this.constants.CLASS_PREFIX+'wrapper'});},injectWrapper:function(){var current_position={top:this.getScroll('ver'),left:this.getScroll('hor')};this.el.wrapper.inject(this.el.container,'before').grab(this.el.container);if(this.options.prevent_position){this.el.container.scrollTop=current_position.top;this.el.container.scrollLeft=current_position.left;}},createHolder:function(){this.el.holder=new Element('div',{'class':this.constants.CLASS_PREFIX+'holder'}).inject(this.el.wrapper);this.options.horizontal&&this.el.holder.addClass(this.constants.CLASS_PREFIX+'holder-hor');this.options.vertical&&this.el.holder.addClass(this.constants.CLASS_PREFIX+'holder-ver');},createTracks:function(){if(this.options.horizontal){this.el.hor_track=new Element('div',{'class':this.constants.CLASS_PREFIX+'track '+this.constants.CLASS_PREFIX+'track-hor','events':{click:this.fns.onClick}}).inject(this.el.holder);}
if(this.options.vertical){this.el.ver_track=new Element('div',{'class':this.constants.CLASS_PREFIX+'track '+this.constants.CLASS_PREFIX+'track-ver','events':{click:this.fns.onClick}}).inject(this.el.holder);}},createScrollers:function(){if(this.options.horizontal){this.el.hor_scroller=new Element('div',{'class':this.constants.CLASS_PREFIX+'er '+this.constants.CLASS_PREFIX+'er-hor','events':{click:this.fns.onClick,mouseover:this.fns.onMouseOver,mouseout:this.fns.onMouseOut,mousedown:this.fns.onMouseDown,mouseup:this.fns.onMouseUp}}).inject(this.el.holder);}
if(this.options.vertical){this.el.ver_scroller=new Element('div',{'class':this.constants.CLASS_PREFIX+'er '+this.constants.CLASS_PREFIX+'er-ver','events':{click:this.fns.onClick,mouseover:this.fns.onMouseOver,mouseout:this.fns.onMouseOut,mousedown:this.fns.onMouseDown,mouseup:this.fns.onMouseUp}}).inject(this.el.holder);}},createButtons:function(){if(this.options.horizontal){this.el.button_left=new Element('div',{'class':this.constants.CLASS_PREFIX+'btn '+this.constants.CLASS_PREFIX+'btn-left','direction':'hor','multiply':1,'events':{click:this.fns.onClick}}).inject(this.el.holder);this.el.button_right=new Element('div',{'class':this.constants.CLASS_PREFIX+'btn '+this.constants.CLASS_PREFIX+'btn-right','direction':'hor','multiply':-1,'events':{click:this.fns.onClick}}).inject(this.el.holder);}
if(this.options.vertical){this.el.button_top=new Element('div',{'class':this.constants.CLASS_PREFIX+'btn '+this.constants.CLASS_PREFIX+'btn-top','direction':'ver','multiply':1,'events':{click:this.fns.onClick}}).inject(this.el.holder);this.el.button_bottom=new Element('div',{'class':this.constants.CLASS_PREFIX+'btn '+this.constants.CLASS_PREFIX+'btn-bottom','direction':'ver','multiply':-1,'events':{click:this.fns.onClick}}).inject(this.el.holder);}},initObserver:function(){this.observer=new MutationObserver(function(){var width=this.el.container.getWidth();var height=this.el.container.getHeight();if(width!==this.properties.width||height!==this.properties.height||this.el.container.scrollWidth!==this.properties.scrollWidth||this.el.container.scrollHeight!==this.properties.scrollHeight){this.reinitScrollbars();}}.bind(this));this.observer.observe(this.el.container,{childList:true,attributes:true,subtree:true,attributeFilter:['style']});},initEvents:function(){this.el.container.addEvents({mousewheel:this.options.mousewheel?this.fns.onMouseWheel:this.fns.empty,scroll:this.fns.onScroll});if(this.options.autohide){this.el.wrapper.addEvents({mouseenter:this.showScrollers.bind(this),mouseleave:this.hideScrollers.bind(this)})}
if(this.options.buttons){[this.el.button_top,this.el.button_bottom,this.el.button_left,this.el.button_right].each(function(elem){if(elem){elem.addEvents({mousedown:function(e){this.active_btn=e.target;this.el.container.store('scrollbtn:mousedown:interval',setInterval(this.fns.onButtonMouseDownHold,30));this.onMouseDown(e);}.bind(this),mouseup:function(e){clearInterval(this.el.container.retrieve('scrollbtn:mousedown:interval'));this.onMouseUp(e);}.bind(this),mouseleave:function(e){clearInterval(this.el.container.retrieve('scrollbtn:mousedown:interval'));}.bind(this),mouseover:this.fns.onMouseOver,mouseout:this.fns.onMouseOut});}},this);}},onButtonMouseDownHold:function(){this.applyScrollChange(this.active_btn.getProperty('direction'),Number(this.active_btn.getProperty('multiply'))*this.btn_multiplier);this.onScroll();},onMouseWheel:function(e){var direction=(Browser.name==='firefox')?(e.event.deltaY?'ver':'hor'):((Browser.name==='safari'||Browser.name==='chrome')?(e.event.wheelDeltaY!==0?'ver':'hor'):'ver');var scroller=this.getScroller(direction);if(!scroller){return;}
if(e.wheel!==0&&scroller){var current_position={top:this.getScroll('ver'),left:this.getScroll('hor')};var new_position=this.applyScrollChange(direction,20*(e.wheel/Math.abs(e.wheel)));if(direction=='hor'&&new_position!=current_position.left||direction=='ver'&&new_position!=current_position.top){e.preventDefault();e.stopPropagation();}}},updateScrollers:function(){if(this.options.horizontal){this.updateHorScrollerDimentions();}
if(this.options.vertical){this.updateVerScrollerDimentions();}},updateHorScrollerDimentions:function(){this.updateScrollerDimentions('hor');},updateVerScrollerDimentions:function(){this.updateScrollerDimentions('ver');},updateScrollerDimentions:function(axis){axis=axis||'ver';var size_prop=({hor:'width',ver:'height'})[axis];var scroller=this.getScroller(axis);var cont_size=this.properties[size_prop];if(cont_size==this.getScrollDimension(axis)){this.el.container.removeClass(this.constants.CLASS_PREFIX+'-visible')
this.el.holder.setStyle('display','none');return;}
this.el.container.addClass(this.constants.CLASS_PREFIX+'-visible')
this.el.holder.setStyle('display','');var scrollsize=this.getScrollDimension(axis);var size=Math.round((cont_size/scrollsize||0)*cont_size);scroller.setStyle(size_prop,size);var drag=new Drag(scroller,{snap:0,modifiers:{x:axis=='hor'?'left':'',y:axis=='ver'?'top':''},limit:this[({hor:'getHorDragLimits',ver:'getVerDragLimits'})[axis]](cont_size-size)});drag.addEvents({start:this.fns.onDragStart,drag:this.fns[({hor:'onHorScrollerDrag',ver:'onVerScrollerDrag'})[axis]],complete:this.fns.onDragComplete});},getScroller:function(axis){axis=Array.pick([axis,'ver']);return this.el[axis+'_scroller'];},onHorScrollerDrag:function(scroller){var track_width=this.getHorTrackLength();var distance=this.getHorScrollerPosition();var ratio=(this.getScrollDimension('hor')-this.properties.width)/track_width;var scroll_to=distance*ratio;this.applyScrollChange('hor',0,scroll_to);},onVerScrollerDrag:function(scroller){var track_height=this.properties.height-scroller.getHeight();var distance=scroller.getPosition(this.el.wrapper).y;var ratio=(this.el.container.scrollHeight-this.properties.height)/track_height;var scroll_to=distance*ratio;this.applyScrollChange('ver',0,scroll_to);},onDragStart:function(){this.scroller_drag=true;this.fireEvent('dragstart');},onDragComplete:function(){this.scroller_drag=false;this.fireEvent('dragcomplete');},onScroll:function(){if(!this.scroller_drag){this.updateScrollersPositions();}},onClick:function(e){e.stopPropagation();},onMouseOver:function(e){e.target.addClass(this.constants.CLASS_PREFIX+'-over');},onMouseOut:function(e){e.target.removeClass(this.constants.CLASS_PREFIX+'-over');},onMouseDown:function(e){e.target.addClass(this.constants.CLASS_PREFIX+'-click');},onMouseUp:function(e){e.target.removeClass(this.constants.CLASS_PREFIX+'-click');},applyScrollChange:function(direction,distance,value){var axis={'ver':'scrollTop','hor':'scrollLeft'};if(distance){this.el.container[axis[direction]]-=distance;}else{this.el.container[axis[direction]]=value;}
return this.el.container[axis[direction]];},updateScrollersPositions:function(){if(this.shouldApplyCustomScrollbar()){if(this.options.horizontal){this.updateHorScrollerPosition();}
if(this.options.vertical){this.updateVerScrollerPosition();}}},updateHorScrollerPosition:function(){var scroller=this.getScroller('hor');var track_width=this.getHorTrackLength();var distance=this.getScroll('hor');var ratio=(this.getScrollDimension('hor')-this.properties.width)/track_width;var position=distance/ratio;scroller.setStyle('left',position);},updateVerScrollerPosition:function(){var scroller=this.getScroller('ver');var track_height=this.properties.height-scroller.getHeight();var distance=this.el.container.scrollTop;var ratio=(this.el.container.scrollHeight-this.properties.height)/track_height;var position=distance/ratio;scroller.setStyle('top',position||0);},showScrollers:function(){clearTimeout(this.hide_delay);if(this.options.horizontal){this.getScroller('hor').setStyle('display','');}
if(this.options.vertical){this.getScroller('ver').setStyle('display','');}},hideScrollers:function(){if(this.scroller_drag){this.hide_delay=setTimeout(this.fns.hideScrollers,100);return;}
if(this.options.horizontal){this.getScroller('hor').setStyle('display','none');}
if(this.options.vertical){this.getScroller('ver').setStyle('display','none');}},getHorTrackLength:function(){return this.properties.width-this.getScroller('hor').getWidth();},getVerTrackLength:function(){return this.properties.height-this.getScroller('ver').getHeight();},getHorScrollerPosition:function(scroller){return(scroller||this.getScroller('hor')).getPosition(this.el.wrapper).x;},getVerScrollerPosition:function(scroller){return(scroller||this.getScroller('ver')).getPosition(this.el.wrapper).y;},getScrollDimensionProperty:function(direction){return({'hor':'scrollWidth','ver':'scrollHeight'})[direction||'ver'];},getScrollDimension:function(direction){return this.el.container[this.getScrollDimensionProperty(direction)];},getHorDragLimits:function(limit){return{x:[0,limit],y:[0,0]};},getVerDragLimits:function(limit){return{x:[0,0],y:[0,limit]};},getScrollProperty:function(direction){return({'hor':'scrollLeft','ver':'scrollTop'})[direction||'ver'];},getScroll:function(direction){return this.el.container[this.getScrollProperty(direction)];},reinitScrollbars:function(){if(this.shouldApplyCustomScrollbar()){this.retrieveProperties();this.updateScrollers();}},destroy:function(){this.el.container.removeEvents({mousewheel:this.options.mousewheel?this.fns.onMouseWheel:this.fns.empty,scroll:this.fns.onScroll});var current_position={top:this.getScroll('ver'),left:this.getScroll('hor')};this.el.container.inject(this.el.wrapper,'before');this.el.wrapper.destroy();if(this.options.dynamic){this.observer.disconnect();}
if(this.options.prevent_position){this.el.container.scrollTop=current_position.top;this.el.container.scrollLeft=current_position.left;}}});