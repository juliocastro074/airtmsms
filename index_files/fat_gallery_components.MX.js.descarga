SK.LinkHelper=SK.LinkHelper||{extractLinksOnElements:function(t){this.list&&t(this.list),this.callbacks=this.callbacks||[],this.callbacks.push(t),this.is_called||((new SK.API).execute("object.site.get_pages",{},function(t,e,i){if(t){var n=i.pages.links;this.list={};for(var s=0,r=n.length;s<r;s++){this.list[SK.Util.deserializeNodeId(n[s].node_id)]=n[s].full_url;for(var a=0,o=n[s].anchors.length;a<o;a++)this.list[n[s].anchors[a].link]=[n[s].full_url,"#",n[s].anchors[a].name].join("")}this.callbacks.forEach(function(t){t(this.list)},this),this.callbacks=[]}}.bind(this)),this.is_called=!0)}.bind({})},Function.prototype.throttle=function(t){var e=this;return e.time=e.time||Date.now()+t,function(){var i=Date.now();if(e.time<=i)return e.time=i+t,e.apply(null,arguments)}},SK="undefined"==typeof SK?{}:SK,void 0===SK.LazyLoader&&(SK.LazyLoader=function(){this.is_first_intersection=!0,this.visible_elements=[],this.buffered_elements=[]},SK.LazyLoader.prototype={constructor:SK.LazyLoader,spacer:"/Shared/Images/space.gif",delay_timeout:300,poll_interval:100,has_native_support:"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype&&"isIntersecting"in window.IntersectionObserverEntry.prototype,initLazyLoad:function(t,e){this.elements=t,this.properties=Object.assign({},{scroll_wrapper:null,buffer_size:3,is_scroll_delayed:!0,max_visible_count:0},e),this.filterEntries=this.filterEntries.bind(this),this.loadResources(this.createObserver.bind(this,t))},loadResources:function(t){this.has_native_support?t():SK.RequestJS("/Shared/Scripts/intersection_observer.js",{callback:t})},createObserver:function(t){this.elements.length&&(this.has_native_support||(IntersectionObserver.prototype.POLL_INTERVAL=this.poll_interval),this.entries_map=new Map,this.observer=new IntersectionObserver(this.onIntersection.bind(this),{root:this.properties.scroll_wrapper,threshold:.01}),this.observeElements(t))},observeElements:function(t){for(var e=0;e<t.length;e++)this.observer.observe(t[e])},onIntersection:function(t){var e=this,i=!e.is_first_intersection&&e.properties.is_scroll_delayed;e.is_first_intersection=!1,t.forEach(function(t){e.entries_map.set(t.target,t)}),i?(clearTimeout(e.timeout),e.timeout=setTimeout(e.filterEntries,e.delay_timeout)):e.filterEntries()},filterEntries:function(){var t=this;if(t.entries_map.forEach(function(e){var i=t.visible_elements.indexOf(e.target);e.intersectionRatio>0&&e.isIntersecting?i<0&&t.visible_elements.push(e.target):~i&&t.visible_elements.splice(i,1)}),t.visible_elements.length){t.entries_map.clear(),t.buffered_elements.length=0;for(var e=this.properties.max_visible_count||t.visible_elements.length,i=e*t.properties.buffer_size,n=t.visible_elements.map(function(e){return[].indexOf.call(t.elements,e)}),s=Math.min.apply(Math,n),r=Math.max.apply(Math,n),a=0;a<=t.properties.buffer_size;a++)t.buffered_elements.push([]);a=s-1;for(var o=0;a>=Math.max(s-i,0);a--,o++)t.elements[a].loaded||t.elements[a].loading||t.buffered_elements[Math.round(o/e)].push(t.elements[a]);for(a=r+1,o=0;a<Math.min(r+1+i,t.elements.length);a++,o++)t.elements[a].loaded||t.elements[a].loading||t.buffered_elements[Math.round(o/e)].push(t.elements[a]);var l=[t.loadElements.bind(t,t.visible_elements)];t.buffered_elements.forEach(function(e){e.length&&l.push(t.loadElements.bind(t,e))}),new SK.Sync(l,function(){},alert).run()}},loadElements:function(t,e){for(var i=[],n=0;n<t.length;n++)i.push(this.load.bind(this,t[n]));new SK.Async(i,function(){e.ready()},alert).run()},load:function(t,e){if(this.has_native_support||!t.loaded&&!t.loading){var i,n="IMG"==t.tagName;if(n||(i=t.querySelector("img")),t.loading=!0,n||i)(i||t).addEvent("load",this.onSuccessfulLoad.bind(this,t,e));else{var s=this.getElementSrc(t);if(!s)return void this.onSuccessfulLoad(t,e);var r=new Image;r.onload=this.onSuccessfulLoad.bind(this,t,e),r.setAttribute("src",s)}this.displayElement(i||t)}else e.ready()},getElementSrc:function(t){return t.getAttribute("data-src")},getElementSrcset:function(t){return t.getAttribute("data-srcset")},displayElement:function(t){var e="IMG"==t.tagName,i=this.getElementSrcset(t),n=this.getElementSrc(t);if(e)n=n||t.getAttribute("src")==this.spacer?n:this.spacer,i&&t.setAttribute("srcset",i),n&&t.setAttribute("src",n);else{var s=t.style.backgroundImage;["none",this.spacer].indexOf(s)<0&&(t.style.backgroundImage="url("+n+")")}},onSuccessfulLoad:function(t,e){t.loading=!1,t.loaded=!0,e.ready()},destroy:function(){if(this.observer){this.entries_map=null;for(var t=0;t<this.elements.length;t++)delete this.elements[t].loading,delete this.elements[t].loaded;this.observer.disconnect()}}}),["touchstart","touchmove","touchend"].each(function(t){Element.NativeEvents[t]=2}),Element.Events.swipe={onAdd:function(t){var e,i,n=!1,s=function(t){n=!0,e=t.event.touches[0].pageX,i=t.event.touches[0].pageY},r=function(s){var r=s.event.touches[0].pageX,a=s.event.touches[0].pageY,o=r-e,l=o<-1*Element.Events.swipe.swipeWidth,h=o>Element.Events.swipe.swipeWidth;if(!n||!h&&!l||s.onlySwipeLeft&&!l||s.onlySwipeRight&&!h||(n=!1,t.call(this,{direction:h?"right":"left",startX:e,endX:r})),Element.Events.swipe.cancelVertical&&Math.abs(i-a)<Math.abs(e-r))return!1};this.addEvent("touchstart",s),this.addEvent("touchmove",r);var a={};a[t]={touchstart:s,touchmove:r},this.store("swipeAddedEvents",a)},onRemove:function(t){$H(this.retrieve("swipeAddedEvents")[t]).each(function(t,e){this.removeEvent(e,t)},this)}},Element.Events.swipe.swipeWidth=70,Element.Events.swipe.cancelVertical=!0,SK="undefined"==typeof SK?{}:SK,SK.addRecursivelyKOObservables=function(t,e){var i={};for(var n in t)if("object"==typeOf(t[n]))i[n]=SK.addRecursivelyKOObservables(t[n],e);else if("array"==typeOf(t[n])){i[n]=e.observableArray([]);for(var s=0,r=t[n].length;s<r;s++)i[n].push(SK.addRecursivelyKOObservables(t[n][s],e))}else i[n]=e.observable(e.unwrap(t[n]));return i},SK.updateRecursivelyKOObservables=function(t,e,i){SK._loopRecursivelyKOObservables(t,e,function(n){e[n].removeAll();for(var s=0,r=t[n].length;s<r;s++)e[n].push(SK.addRecursivelyKOObservables(t[n][s],i))},i)},SK.mergeRecursivelyKOObservables=function(t,e,i){SK._loopRecursivelyKOObservables(t,e,function(n){for(var s=0,r=t[n].length;s<r;s++)e[n]()[s]?SK.mergeRecursivelyKOObservables(t[n][s],e[n]()[s],i):e[n].push(SK.addRecursivelyKOObservables(t[n][s],i))},i)},SK._loopRecursivelyKOObservables=function(t,e,i,n){for(var s in t)e&&e.hasOwnProperty(s)&&("object"==typeOf(t[s])?arguments.callee.call(null,t[s],e[s],n):"function"==typeOf(e[s])&&("array"==typeOf(t[s])?i(s):e[s](t[s])))},SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.Display=SK.UI.Element.Gallery.Display||{},SK.UI.Element.Gallery.Renderer=SK.UI.Element.Gallery.Renderer||{default_property_values:{CropImage:"1",GalleryCropIcon:"1",GalleryConfigurationType:"thumbnails",GalleryThumbnailEffect:"none",GalleryThumbnailShape:"original",GalleryVariant:"",GalleryInsideButtons:"0",GalleryPlayButton:"0",GalleryAutoplay:"0",GalleryIconSizeHeight:"80",GalleryIconSizeWidth:"80",GalleryLoop:"1",GalleryScrollbar:"0",NavigationPosition:"bottom",ImagesPerRow:"3",KeepOrigImage:"0",Layout:"plugin",NavigationType:"none",PopupHeight:"1050",PopupTransitionDelay:"5",PopupWidth:"1680",ShowComments:"1",SlideTransitionType:"none",SlideTransitionDelay:"5",ThumbnailBorder:"0",ThumbnailHeight:"0",ThumbnailWidth:"0",ViewerAutoPlay:"0",ViewerCaption:"0",ViewerDim:"0",ViewerLoop:"0",ViewerNav:"buttons",ViewerPlayPause:"0",ViewerPrevNext:"0",ViewerSizeBehaviour:"static",ViewerSizeHeight:"400",ViewerSizeWidth:"400",ViewerZoom:"0",CaptionOffsetTop:"12",CaptionOffsetLeft:"8",CaptionAnimation:"{transitions:['fade','slide'], direction:'right-left'}",Images:"[]"},default_image_values:{Alt:"",CaptionText:"",CaptionAnimation:" ",CaptionOffsetLeft:"",CaptionOffsetTop:"",CustomThumbnail_url:"",CustomThumbnailSrc_height:"0",CustomThumbnailSrc_width:"0",Info:"",InternalLink:"[popup]",Link:"",LinkRel:"",LinkTarget:"",ResizedImageJSON:{},ResizedThumbnailJSON:{},Size:"0",Image_url:SK.Singletons.env.get("static_image_server")+"/Shared/Images/thumbnails_preview.svg#SYSTEM",Src_height:"0",Src_width:"0",UseFilenameCaption:"0"},gallery_settings:{slideshow:{label:"Presentación de diapositivas",count:3,image_options:{Src_width:"600",Src_height:"400"},gallery_options:{ThumbnailWidth:"600",ThumbnailHeight:"400",GalleryVariant:"",SlideTransitionType:"slide",GalleryInsideButtons:"1"},wrapper_classes:{gallery:"ig-type-slideshow",mask:"ig-mask",thumbnails:"ig-slide"},sizes:{small:{width:480,height:320,tooltip:"Pequeño"},medium:{width:600,height:400,tooltip:"Mediano"},large:{width:720,height:480,tooltip:"Grande"}},minimum_size:{width:200,height:140},transitions:[{none:"Ninguno"},{fade:"Fundido"},{slide:"Diapositiva"}]},filmstrip:{label:"Tira de imágenes",count:6,image_options:{Src_width:"600",Src_height:"400"},gallery_options:{ThumbnailWidth:"600",ThumbnailHeight:"400",GalleryVariant:"icons-bottom",SlideTransitionType:"slide",GalleryCropIcon:"1",GalleryInsideButtons:"1"},wrapper_classes:{gallery:"ig-type-filmstrip",mask:"ig-mask",thumbnails:"ig-slide"},sizes:{small:{width:480,height:320,tooltip:"Pequeño"},medium:{width:600,height:400,tooltip:"Mediano"},large:{width:720,height:480,tooltip:"Grande"}},minimum_size:{width:200,height:140},transitions:[{none:"Ninguno"},{fade:"Fundido"},{slide:"Diapositiva"}]},thumbnails:{label:"Miniaturas",count:9,image_options:{Src_width:"200",Src_height:"150"},gallery_options:{ThumbnailWidth:"200",ThumbnailHeight:"150",GalleryVariant:""},wrapper_classes:{gallery:"ig-type-thumbnails",mask:"ig-slide-item",thumbnails:"ig-slide"},sizes:{small:{width:120,height:90,tooltip:"Pequeño"},medium:{width:200,height:150,tooltip:"Mediano"},large:{width:280,height:210,tooltip:"Grande"}},minimum_size:{width:120,height:90},transitions:[]},mosaic:{label:"Mosaico",count:9,image_options:{Src_width:"600",Src_height:"400"},gallery_options:{ThumbnailWidth:"600",ThumbnailHeight:"400",GalleryVariant:"icons-right",SlideTransitionType:"slide",GalleryCropIcon:"1",GalleryInsideButtons:"1"},wrapper_classes:{gallery:"ig-type-mosaic",mask:"ig-mask",thumbnails:"ig-slide"},sizes:{small:{width:480,height:320,tooltip:"Pequeño"},medium:{width:600,height:400,tooltip:"Mediano"},large:{width:720,height:480,tooltip:"Grande"}},minimum_size:{width:200,height:140},transitions:[{none:"Ninguno"},{fade:"Fundido"},{slide:"Diapositiva"}]},slider:{label:"Control deslizante",count:3,image_options:{Src_width:"800",Src_height:"400"},gallery_options:{ThumbnailWidth:"800",ThumbnailHeight:"400",GalleryVariant:"",GalleryAutoplay:"1",GalleryPlayButton:"1"},wrapper_classes:{gallery:"ig-type-slider",mask:"ig-mask",thumbnails:""},sizes:{small:{width:600,height:300,tooltip:"Pequeño"},medium:{width:800,height:400,tooltip:"Mediano"},large:{width:1e3,height:500,tooltip:"Grande"}},minimum_size:{width:300,height:150},transitions:[]}},isZeroFootprintEnabled:function(){return!1},getDefaultImageValues:function(){return this.default_image_values},getGallerySettings:function(){return this.gallery_settings},getGallerySettingsForType:function(t){return this.gallery_settings[t]||{}},getDefaultProperty:function(t){return this.default_property_values[t]},buildGalleryStyles:function(){var t="#e"+this.env.node_id,e=[],i=Number(this.getProperty("ImagesPerRow")),n=Number(this.getProperty("ThumbnailWidth")),s=Number(this.getProperty("ThumbnailHeight")),r=this.getProperty("GalleryConfigurationType"),a=this.getProperty("GalleryVariant");if(e=(e=e.concat([t," .ig-gallery-no-js.ig-gallery-loading {","height: auto;","opacity : 1;","} ",t," .ig-gallery-no-js.ig-gallery.sk-ig-image-gallery .ig-img-loading {","background: transparent;","} "])).concat([t," .ig-gallery-loading {","height : ","thumbnails"!=r?s:s*this.env.image_list().length/i,"px","}"]),"thumbnails"!=r){var o="slider"==r?["height : ",s,"px;"].join(""):["padding-bottom : ",SK.Util.toPercent(this.getProperty("ThumbnailHeight")/this.getProperty("ThumbnailWidth"))].join("");e=e.concat([t," .ig-thumbs .ig-img-loading {","max-height : 100%;",o,"} "])}if(("slider"==r||"slideshow"==r&&"animated_captions"==a)&&(e=e.concat([t," .ig-gallery {","max-width : ",n,"px;","} "])),["slideshow","mosaic","filmstrip"].contains(r)&&(e=e.concat([t," .sk-ig-image-gallery .ig-thumbs {",["mosaic","filmstrip"].contains(r)&&"ie"==Browser.name?"width : ":"max-width : ",n,"px;",i?"":"flex-basis : "+("ie"==Browser.name?100:n)+"%;","} "])),Number(this.getProperty("CropImage"))||"original"!=this.getProperty("GalleryThumbnailShape")||"slider"==r||(e=e.concat([t," .sk-ig-image-gallery .ig-img {","max-width : ",n,"px;","} ",t," .sk-ig-image-gallery .ig-img img {","max-height : ",s,"px;","} "])),"thumbnails"==r&&(e=e.concat([t," .sk-ig-image-gallery .ig-img {","height : ",s,"px;","} ",t," .ig-thumb,",t," .ig-caption {","width : ",n,"px;","} ",t," .ig-slide-item {",i>0?"max-width: "+i*(n+this.getSideMargin(".ig-thumb"))+"px;":"","} "])),"mosaic"==r&&["icons-left","icons-right"].contains(a)&&(e=e.concat([t," .ig-icongrid .sk-ui-scrollwrapper {",i>0?"max-width: "+(i*(Number(this.getProperty("GalleryIconSizeWidth"))+20)+22)+"px;":"","} ",t," .sk-ig-image-gallery.ig-type-mosaic.ig-navtype-right .ig-icongrid.ig-vertical {",i?"":"width : 100%;","}"])),"filmstrip"!=r&&"mosaic"!=r||(e=e.concat([t," .ig-icongrid .ig-icon,",t," .ig-icongrid .ig-icon .sk-ig-dimensions-wrapper {","width : ",this.getProperty("GalleryIconSizeWidth"),"px;","height : ",this.getProperty("GalleryIconSizeHeight"),"px;","} ",t," .ig-icongrid .ig-icon .clip-wrapper {","max-width : ",this.getProperty("GalleryIconSizeWidth"),"px;","max-height : ",this.getProperty("GalleryIconSizeHeight"),"px;","}"])),["slideshow","mosaic","filmstrip"].contains(r)&&(e=e.concat([t," .ig-thumb {","max-height : ",s,"px;","} "])),"slider"==r){if(e="reflection"==this.getProperty("GalleryThumbnailEffect")?e.concat([t," .sk-ig-image-gallery ",this.getProperty("GalleryLoop").toInt()?" .ig-mask .ig-transition-slider-mgr":" .ig-mask"," {","padding-bottom :",SK.Util.fromPercent(30)*this.getProperty("ThumbnailHeight"),"px;","} "]):e.concat([t," .sk-ui-scrollwrapper .sk-ui-scrolltrack-hor {","margin-top: 10px","} "]),!this.getProperty("ShowComments").toInt()){var l="reflection"==this.getProperty("GalleryThumbnailEffect")?s+SK.Util.fromPercent(30)*this.getProperty("ThumbnailHeight"):"polaroid"==this.getProperty("GalleryThumbnailEffect")?s+this.getPolaroidBorder():s;e=e.concat([t," .ig-mask {","max-height : ",l,"px;","} "])}e=e.concat([t," .sk-ig-slider-spacer,",t," .sk-ig-slider-spacer img {","max-height :",s,"px;","} "])}if(["thumbnails","slider"].contains(r)||"reflection"!=this.getProperty("GalleryThumbnailEffect")||(e=e.concat([t," .sk-ig-image-gallery .ig-mask {","padding-bottom :",SK.Util.fromPercent(30)*this.getProperty("ThumbnailHeight"),"px;","} "]),["mosaic","filmstrip"].contains(r)&&(e=e.concat([t," .ig-icongrid .ig-icon {","padding-bottom :",SK.Util.fromPercent(30)*this.getProperty("GalleryIconSizeHeight"),"px;","} "])),"slideshow"==r&&"animated_captions"==this.getProperty("GalleryVariant")&&~this.getProperty("NavigationPosition").indexOf("bottom")&&(e=e.concat([t," .sk-ig-image-gallery .ig-nav {","margin-bottom :",SK.Util.fromPercent(30)*this.getProperty("ThumbnailHeight")+10,"px;","} "]))),"thumbnails"==r&&"reflection"==this.getProperty("GalleryThumbnailEffect")&&(e=e.concat([t," .sk-ig-image-gallery .ig-img {","padding-bottom : 30%;","} "])),"thumbnails"!=r&&"reflection"==this.getProperty("GalleryThumbnailEffect")&&this.getProperty("GalleryInsideButtons").toInt()&&(e=e.concat([t," .sk-ig-image-gallery .ig-thumbs .ig-btn.ig-prev,",t," .sk-ig-image-gallery .ig-thumbs .ig-btn.ig-next {","margin-top : -",SK.Util.fromPercent(30)*this.getProperty("ThumbnailHeight")/2+15,"px;","} "])),"thumbnails"!=r&&"reflection"==this.getProperty("GalleryThumbnailEffect")&&this.getProperty("GalleryPlayButton").toInt()&&(e=e.concat([t," .sk-ig-image-gallery .ig-btn.ig-play,",t," .sk-ig-image-gallery .ig-btn.ig-pause {","margin-bottom : ",SK.Util.fromPercent(30)*this.getProperty("ThumbnailHeight"),"px;","} "])),"polaroid"==this.getProperty("GalleryThumbnailEffect")&&"slider"!=r){var h={filmstrip:70,mosaic:70,slideshow:70,thumbnails:16}[r]||0;e=e.concat([t," .ig-thumbs .ig-img:not(.ig-img-loading) .effect-polaroid .sk-ig-reflection-wrapper {","max-height:",s-h,"px;","max-width:",n-h,"px",1==this.getProperty("CropImage")?" !important":"",";","} ",t," .ig-icongrid .ig-img:not(.ig-img-loading) .effect-polaroid .sk-ig-reflection-wrapper {","max-height:",Number(this.getProperty("GalleryIconSizeHeight"))-6,"px;","max-width:",Number(this.getProperty("GalleryIconSizeWidth"))-6,"px;","} "]),!Number(this.getProperty("CropImage"))&&"original"==this.getProperty("GalleryThumbnailShape")&&(e=e.concat([t," .ig-thumbs .ig-img:not(.ig-img-loading) .effect-polaroid .sk-ig-reflection-wrapper {","height: auto;","width: auto;","} ",t," .ig-thumbs .ig-img:not(.ig-img-loading) .effect-polaroid .sk-ig-reflection-wrapper img {","max-height : ",s-h,"px;","} ",t," .ig-icongrid .ig-img:not(.ig-img-loading) .effect-polaroid .sk-ig-reflection-wrapper img {","max-height : ",Number(this.getProperty("GalleryIconSizeHeight"))-6,"px;","} "])),"filmstrip"==r&&(e=e.concat([t," .ig-icongrid .ig-icon { ",["icons-left","icons-right"].contains(this.getProperty("GalleryVariant"))?"margin-top":"margin-left",": 7px; }"]))}return"polaroid"==this.getProperty("GalleryThumbnailEffect")&&"slider"==r&&(e=e.concat([t," .ig-transition-item, ",t," .ig-transition-slider-item "," {","margin: 0 35px 65px;","}",t," .ig-caption {","transform: translateY( 50px );","}"])),e.join("")},getSideMargin:function(t){return 20},getPolaroidBorder:function(){return 70},createComputed:function(){this.env.selected_index=this.env.ko.observable(0),this.env.custom_width_message=this.env.ko.observable(""),this.env.custom_height_message=this.env.ko.observable(""),this.env.images=this.env.addRecursivelyKOObservables({data:(SK.Util.decodeJSON(this.getProperty("Images"))||[]).map(function(t){return Object.merge({},this.getDefaultImageValues(),t)},this)},this.env.ko),this.env.escapeEntityChars=function(t){return SK.Singletons.gallery_helper_area=SK.Singletons.gallery_helper_area||document.createElement("textarea"),SK.Singletons.gallery_helper_area.innerHTML="function"==typeof t?t():t,SK.Singletons.gallery_helper_area.value},this.env.uploaded_images=this.env.ko.computed(function(){var t=this.env.ko.toJS(this.env.images.data);return this.setProperty("Images",JSON.stringify(t)),t},this),this.env.image_list=this.env.ko.computed(function(){if(this.env.images.data().length)return this.env.images.data();if(!SK.Singletons.env.get("admin_mode"))return[];var t=this.getGallerySettingsForType(this.getProperty("GalleryConfigurationType"));return this.setProperties(t.gallery_options),this.setAnimation.delay(0,this),this.env.addRecursivelyKOObservables({data:Array.apply(null,{length:t.count}).map(Object.extend,Object.merge({},this.getDefaultImageValues(),t.image_options,{CaptionText:"Título de la imagen"}))},this.env.ko).data()},this),this.env.should_display_icongrid=this.env.ko.computed(function(){return["filmstrip","mosaic"].contains(this.getProperty("GalleryConfigurationType"))},this),this.env.icongrid_css=this.env.ko.computed(function(){return{"ig-vertical":["icons-left","icons-right"].contains(this.getProperty("GalleryVariant")),"ig-horizontal":["icons-top","icons-bottom"].contains(this.getProperty("GalleryVariant")),"ig-icon-reflection":"reflection"==this.getProperty("GalleryThumbnailEffect")}},this),this.env.gallery_styles=this.env.ko.computed(function(){var t=this.getProperty("GalleryConfigurationType"),e=this.getProperty("GalleryVariant"),i=this.getGallerySettingsForType(t),n=i.wrapper_classes.gallery;return 0==this.env.uploaded_images().length&&(n+="  sk-skip-in-preview"),"slideshow"==t&&"animated_captions"==e&&(n="ig-type-slideshow-animated"),this.env.ko.unwrap(this.env.images.data).length||(n+=" ig-empty-placeholder"),SK.Singletons.env.get("admin_mode")||this.env.ko.unwrap(this.env.image_list).length||(n+=" ig-gallery-empty"),{gallery:n+(this.env.should_display_icongrid()?" ig-navtype-"+e.replace("icons-",""):""),mask:i.wrapper_classes.mask,thumb:i.wrapper_classes.thumbnails}},this),this.env.styles=this.env.ko.computed(this.buildGalleryStyles,this),this.env.largeImageViewerStyles=function(){var t="static"==this.getProperty("ViewerSizeBehaviour");return{"max-width":t?this.getProperty("ViewerSizeWidth")+"px":null,"max-height":t?this.getProperty("ViewerSizeHeight")+"px":null,"margin-top":t?this.getProperty("ViewerSizeHeight").toInt()/2*-1+"px":null,"margin-left":t?this.getProperty("ViewerSizeWidth").toInt()/2*-1+"px":null}}.bind(this),this.env.getImageMaxWidth=function(t,e){var i="slider"==this.getProperty("GalleryConfigurationType")?Math.round(this.env.ko.unwrap(t.Src_width)/this.env.ko.unwrap(t.Src_height)*this.env.ko.unwrap(e)):0;return Math.min(i,this.env.ko.unwrap(t.Src_width))}.bind(this),this.gatherImageLinks()},gatherImageLinks:function(){this.env.links_list=this.env.ko.observable({});var t={};this.placeholder.getElements("a").each(function(e){t[e.get("data-node")]=e.get("href")},this),SK.Singletons.env.get("admin_mode")&&"nodejs"!=Browser.name?SK.LinkHelper.extractLinksOnElements(t=>{this.env.links_list(t),this.lazyLoadImages&&this.lazyLoadImages()}):this.env.links_list(t)}},SK.UI.Element.Gallery.Display.Renderer=SK.UI.Element.Gallery.Display.Renderer||new Class(Object.append({Extends:SK.UI.Element.Display},SK.UI.Element.Gallery.Renderer)),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.MousePointerScrollHandler=new Class({Implements:[Options],options:{container:null,mode:"vertical",restarea:3,maxspeed:6,onChange:null},frameSize:{x:0,y:0},actualSize:{x:0,y:0},axis:null,state:{runing:!1,direction:"none"},initialize:function(t){this.setOptions(t),this.container=_$(this.options.container),this.axis="vertical"==this.options.mode?"y":"x",this.bounds={mousemove:this.engine.bind(this),mouseleave:this.stopScroll.bind(this)},this.container.addEvents(this.bounds)},engine:function(t){this.frameSize=this.container.getSize(),this.actualSize=this.container.getScrollSize();var e=this.container.getScrolls(),i=this.container.getPosition(),n=t.page[this.axis]-i[this.axis]-e[this.axis],s=(this.frameSize[this.axis]-this.options.restarea)/2,r=(this.frameSize[this.axis]+this.options.restarea)/2;n>r?(this.scrollspeed=(n-r)/((this.frameSize[this.axis]-this.options.restarea)/2)*this.options.maxspeed,this.state.runing&&"next"!=this.state.direction&&this.stopScroll(),this.state.runing||(clearInterval(this.scrollInterval),this.scrollInterval=this.scrollNext.periodical(10,this))):n<s?(this.scrollspeed=(s-n)/((this.frameSize[this.axis]-this.options.restarea)/2)*this.options.maxspeed,this.state.runing&&"previous"!=this.state.direction&&this.stopScroll(),this.state.runing||(clearInterval(this.scrollInterval),this.scrollInterval=this.scrollPrev.periodical(10,this))):(this.stopScroll(),this.scrollspeed=0)},stopScroll:function(t){clearInterval(this.scrollInterval),this.state.runing=!1,this.state.direction="none"},scrollPrev:function(){this.state.runing=!0,this.state.direction="previous";var t=this.container.getScroll();t[this.axis]>0?this.setScroll(t[this.axis]-this.scrollspeed):this.stopScroll()},scrollNext:function(){this.state.runing=!0,this.state.direction="next";var t=this.container.getScroll();t[this.axis]<this.actualSize[this.axis]-this.frameSize[this.axis]?this.setScroll(t[this.axis]+this.scrollspeed):this.stopScroll()},setScroll:function(t){t=parseInt(t),"vertical"==this.options.mode?this.container.scrollTo(0,t):this.container.scrollTo(t),this.options.onChange&&this.options.onChange.apply(this,arguments)},destroy:function(){this.container.removeEvents(this.bounds)}}),"undefined"==typeof SK&&(SK={}),void 0===SK.UI&&(SK.UI={}),SK.UI.Scrollbar=new Class({Implements:[Events,Options],constants:{CLASS_PREFIX:"sk-ui-scroll"},options:{horizontal:!1,vertical:!0,autohide:!1,dynamic:!0,buttons:!1,track:!1,mousewheel:!0,replace_osx_native:!1,prevent_position:!1},el:{container:null,scroller:null},properties:{width:null,height:null},fns:{},scroller_drag:!1,btn_multiplier:10,is_mobile:!!(navigator.userAgent+"").match(/(iPhone|iPad|iPod|android|htc|mobile)/i),osx_version:((navigator.userAgent+"").match(/Mac OS X (10(?:\.|_)[789])/)||["",""])[1].replace("_",".").toFloat(),initialize:function(t,e){this.el.container=_$(t),this.setOptions(e),this.shouldApplyCustomScrollbar()&&this.init()},hasNativeOSXScrollers:function(){return this.is_mobile||this.osx_version>10.7||this.osx_version&&["safari","chrome"].contains(Browser.name)},shouldApplyCustomScrollbar:function(){return!this.hasNativeOSXScrollers()||this.options.replace_osx_native},init:function(){this.createBoundedFunctions(),this.retrieveProperties(),this.setStyles(),this.createElements(),this.initEvents(),this.options.dynamic&&this.initObserver()},createBoundedFunctions:function(){this.fns={onButtonMouseDownHold:this.onButtonMouseDownHold.bind(this),hideScrollers:this.hideScrollers.bind(this),onDragStart:this.onDragStart.bind(this),onHorScrollerDrag:this.onHorScrollerDrag.bind(this),onVerScrollerDrag:this.onVerScrollerDrag.bind(this),onDragComplete:this.onDragComplete.bind(this),onClick:this.onClick.bind(this),onScroll:this.onScroll.bind(this),onMouseWheel:this.onMouseWheel.bind(this),onMouseOver:this.onMouseOver.bind(this),onMouseOut:this.onMouseOut.bind(this),onMouseDown:this.onMouseDown.bind(this),onMouseUp:this.onMouseUp.bind(this),empty:function(){}}},retrieveProperties:function(){this.properties.width=this.el.container.getWidth(),this.properties.height=this.el.container.getHeight(),this.properties.scrollWidth=this.el.container.scrollWidth,this.properties.scrollHeight=this.el.container.scrollHeight},setStyles:function(){this.options.horizontal&&this.el.container.setStyle("overflow-x","hidden"),this.options.vertical&&this.el.container.setStyle("overflow-y","hidden")},createElements:function(){this.createWrapper(),this.injectWrapper(),this.createHolder(),this.options.track&&this.createTracks(),this.createScrollers(),this.updateScrollers(),this.options.buttons&&this.createButtons()},createWrapper:function(){this.el.wrapper=new Element("div",{class:this.constants.CLASS_PREFIX+"wrapper"})},injectWrapper:function(){var t={top:this.getScroll("ver"),left:this.getScroll("hor")};this.el.wrapper.inject(this.el.container,"before").grab(this.el.container),this.options.prevent_position&&(this.el.container.scrollTop=t.top,this.el.container.scrollLeft=t.left)},createHolder:function(){this.el.holder=new Element("div",{class:this.constants.CLASS_PREFIX+"holder"}).inject(this.el.wrapper),this.options.horizontal&&this.el.holder.addClass(this.constants.CLASS_PREFIX+"holder-hor"),this.options.vertical&&this.el.holder.addClass(this.constants.CLASS_PREFIX+"holder-ver")},createTracks:function(){this.options.horizontal&&(this.el.hor_track=new Element("div",{class:this.constants.CLASS_PREFIX+"track "+this.constants.CLASS_PREFIX+"track-hor",events:{click:this.fns.onClick}}).inject(this.el.holder)),this.options.vertical&&(this.el.ver_track=new Element("div",{class:this.constants.CLASS_PREFIX+"track "+this.constants.CLASS_PREFIX+"track-ver",events:{click:this.fns.onClick}}).inject(this.el.holder))},createScrollers:function(){this.options.horizontal&&(this.el.hor_scroller=new Element("div",{class:this.constants.CLASS_PREFIX+"er "+this.constants.CLASS_PREFIX+"er-hor",events:{click:this.fns.onClick,mouseover:this.fns.onMouseOver,mouseout:this.fns.onMouseOut,mousedown:this.fns.onMouseDown,mouseup:this.fns.onMouseUp}}).inject(this.el.holder)),this.options.vertical&&(this.el.ver_scroller=new Element("div",{class:this.constants.CLASS_PREFIX+"er "+this.constants.CLASS_PREFIX+"er-ver",events:{click:this.fns.onClick,mouseover:this.fns.onMouseOver,mouseout:this.fns.onMouseOut,mousedown:this.fns.onMouseDown,mouseup:this.fns.onMouseUp}}).inject(this.el.holder))},createButtons:function(){this.options.horizontal&&(this.el.button_left=new Element("div",{class:this.constants.CLASS_PREFIX+"btn "+this.constants.CLASS_PREFIX+"btn-left",direction:"hor",multiply:1,events:{click:this.fns.onClick}}).inject(this.el.holder),this.el.button_right=new Element("div",{class:this.constants.CLASS_PREFIX+"btn "+this.constants.CLASS_PREFIX+"btn-right",direction:"hor",multiply:-1,events:{click:this.fns.onClick}}).inject(this.el.holder)),this.options.vertical&&(this.el.button_top=new Element("div",{class:this.constants.CLASS_PREFIX+"btn "+this.constants.CLASS_PREFIX+"btn-top",direction:"ver",multiply:1,events:{click:this.fns.onClick}}).inject(this.el.holder),this.el.button_bottom=new Element("div",{class:this.constants.CLASS_PREFIX+"btn "+this.constants.CLASS_PREFIX+"btn-bottom",direction:"ver",multiply:-1,events:{click:this.fns.onClick}}).inject(this.el.holder))},initObserver:function(){this.observer=new MutationObserver(function(){var t=this.el.container.getWidth(),e=this.el.container.getHeight();t===this.properties.width&&e===this.properties.height&&this.el.container.scrollWidth===this.properties.scrollWidth&&this.el.container.scrollHeight===this.properties.scrollHeight||this.reinitScrollbars()}.bind(this)),this.observer.observe(this.el.container,{childList:!0,attributes:!0,subtree:!0,attributeFilter:["style"]})},initEvents:function(){this.el.container.addEvents({mousewheel:this.options.mousewheel?this.fns.onMouseWheel:this.fns.empty,scroll:this.fns.onScroll}),this.options.autohide&&this.el.wrapper.addEvents({mouseenter:this.showScrollers.bind(this),mouseleave:this.hideScrollers.bind(this)}),this.options.buttons&&[this.el.button_top,this.el.button_bottom,this.el.button_left,this.el.button_right].each(function(t){t&&t.addEvents({mousedown:function(t){this.active_btn=t.target,this.el.container.store("scrollbtn:mousedown:interval",setInterval(this.fns.onButtonMouseDownHold,30)),this.onMouseDown(t)}.bind(this),mouseup:function(t){clearInterval(this.el.container.retrieve("scrollbtn:mousedown:interval")),this.onMouseUp(t)}.bind(this),mouseleave:function(t){clearInterval(this.el.container.retrieve("scrollbtn:mousedown:interval"))}.bind(this),mouseover:this.fns.onMouseOver,mouseout:this.fns.onMouseOut})},this)},onButtonMouseDownHold:function(){this.applyScrollChange(this.active_btn.getProperty("direction"),Number(this.active_btn.getProperty("multiply"))*this.btn_multiplier),this.onScroll()},onMouseWheel:function(t){var e="firefox"===Browser.name?t.event.deltaY?"ver":"hor":"safari"===Browser.name||"chrome"===Browser.name?0!==t.event.wheelDeltaY?"ver":"hor":"ver",i=this.getScroller(e);if(i&&0!==t.wheel&&i){var n={top:this.getScroll("ver"),left:this.getScroll("hor")},s=this.applyScrollChange(e,t.wheel/Math.abs(t.wheel)*20);("hor"==e&&s!=n.left||"ver"==e&&s!=n.top)&&(t.preventDefault(),t.stopPropagation())}},updateScrollers:function(){this.options.horizontal&&this.updateHorScrollerDimentions(),this.options.vertical&&this.updateVerScrollerDimentions()},updateHorScrollerDimentions:function(){this.updateScrollerDimentions("hor")},updateVerScrollerDimentions:function(){this.updateScrollerDimentions("ver")},updateScrollerDimentions:function(t){var e={hor:"width",ver:"height"}[t=t||"ver"],i=this.getScroller(t),n=this.properties[e];if(n==this.getScrollDimension(t))return this.el.container.removeClass(this.constants.CLASS_PREFIX+"-visible"),void this.el.holder.setStyle("display","none");this.el.container.addClass(this.constants.CLASS_PREFIX+"-visible"),this.el.holder.setStyle("display","");var s=this.getScrollDimension(t),r=Math.round((n/s||0)*n);i.setStyle(e,r),new Drag(i,{snap:0,modifiers:{x:"hor"==t?"left":"",y:"ver"==t?"top":""},limit:this[{hor:"getHorDragLimits",ver:"getVerDragLimits"}[t]](n-r)}).addEvents({start:this.fns.onDragStart,drag:this.fns[{hor:"onHorScrollerDrag",ver:"onVerScrollerDrag"}[t]],complete:this.fns.onDragComplete})},getScroller:function(t){return t=Array.pick([t,"ver"]),this.el[t+"_scroller"]},onHorScrollerDrag:function(t){var e=this.getHorTrackLength(),i=this.getHorScrollerPosition()*((this.getScrollDimension("hor")-this.properties.width)/e);this.applyScrollChange("hor",0,i)},onVerScrollerDrag:function(t){var e=this.properties.height-t.getHeight(),i=t.getPosition(this.el.wrapper).y*((this.el.container.scrollHeight-this.properties.height)/e);this.applyScrollChange("ver",0,i)},onDragStart:function(){this.scroller_drag=!0,this.fireEvent("dragstart")},onDragComplete:function(){this.scroller_drag=!1,this.fireEvent("dragcomplete")},onScroll:function(){this.scroller_drag||this.updateScrollersPositions()},onClick:function(t){t.stopPropagation()},onMouseOver:function(t){t.target.addClass(this.constants.CLASS_PREFIX+"-over")},onMouseOut:function(t){t.target.removeClass(this.constants.CLASS_PREFIX+"-over")},onMouseDown:function(t){t.target.addClass(this.constants.CLASS_PREFIX+"-click")},onMouseUp:function(t){t.target.removeClass(this.constants.CLASS_PREFIX+"-click")},applyScrollChange:function(t,e,i){var n={ver:"scrollTop",hor:"scrollLeft"};return e?this.el.container[n[t]]-=e:this.el.container[n[t]]=i,this.el.container[n[t]]},updateScrollersPositions:function(){this.shouldApplyCustomScrollbar()&&(this.options.horizontal&&this.updateHorScrollerPosition(),this.options.vertical&&this.updateVerScrollerPosition())},updateHorScrollerPosition:function(){var t=this.getScroller("hor"),e=this.getHorTrackLength(),i=this.getScroll("hor")/((this.getScrollDimension("hor")-this.properties.width)/e);t.setStyle("left",i)},updateVerScrollerPosition:function(){var t=this.getScroller("ver"),e=this.properties.height-t.getHeight(),i=this.el.container.scrollTop/((this.el.container.scrollHeight-this.properties.height)/e);t.setStyle("top",i||0)},showScrollers:function(){clearTimeout(this.hide_delay),this.options.horizontal&&this.getScroller("hor").setStyle("display",""),this.options.vertical&&this.getScroller("ver").setStyle("display","")},hideScrollers:function(){this.scroller_drag?this.hide_delay=setTimeout(this.fns.hideScrollers,100):(this.options.horizontal&&this.getScroller("hor").setStyle("display","none"),this.options.vertical&&this.getScroller("ver").setStyle("display","none"))},getHorTrackLength:function(){return this.properties.width-this.getScroller("hor").getWidth()},getVerTrackLength:function(){return this.properties.height-this.getScroller("ver").getHeight()},getHorScrollerPosition:function(t){return(t||this.getScroller("hor")).getPosition(this.el.wrapper).x},getVerScrollerPosition:function(t){return(t||this.getScroller("ver")).getPosition(this.el.wrapper).y},getScrollDimensionProperty:function(t){return{hor:"scrollWidth",ver:"scrollHeight"}[t||"ver"]},getScrollDimension:function(t){return this.el.container[this.getScrollDimensionProperty(t)]},getHorDragLimits:function(t){return{x:[0,t],y:[0,0]}},getVerDragLimits:function(t){return{x:[0,0],y:[0,t]}},getScrollProperty:function(t){return{hor:"scrollLeft",ver:"scrollTop"}[t||"ver"]},getScroll:function(t){return this.el.container[this.getScrollProperty(t)]},reinitScrollbars:function(){this.shouldApplyCustomScrollbar()&&(this.retrieveProperties(),this.updateScrollers())},destroy:function(){this.el.container.removeEvents({mousewheel:this.options.mousewheel?this.fns.onMouseWheel:this.fns.empty,scroll:this.fns.onScroll});var t={top:this.getScroll("ver"),left:this.getScroll("hor")};this.el.container.inject(this.el.wrapper,"before"),this.el.wrapper.destroy(),this.options.dynamic&&this.observer.disconnect(),this.options.prevent_position&&(this.el.container.scrollTop=t.top,this.el.container.scrollLeft=t.left)}}),SK.UI.Element.Gallery.Display.Client.implement(SK.UI.Element.Gallery.Renderer),SK.UI.Element.Gallery.Display.Client.implement({options:{fx:{duration:500,link:"chain",unit:"%"},start_at:0},detector:null,lazy_loader:null,placeholder:null,items:null,autoplay:null,is_playing:!1,was_played:!1,handlers:{},scrollbar:null,buttons:{},buttons_handlers:{},speed_factor:1,caption_selector:".ig-caption",large_viewer:null,images_buffer_size:3,icons_buffer_size:1,large_viewer_buffer_size:2,transitions_manager:null,init:function(){this.detector=new SK.UI.Element.Gallery.FeaturesDetector,this.createLazyLoaders(),SK.UI.Element.Display.prototype.initialize.apply(this,this.parameters),this.initEventHandlers(),this.initTransitions(),this.lazyLoadImages=this.lazyLoadImages.delay.bind(this.lazyLoadImages,10,this),this.lazyLoadIcons=this.lazyLoadIcons.delay.bind(this.lazyLoadIcons,10,this),this.initScrollbarSlider=this.initScrollbarSlider.delay.bind(this.initScrollbarSlider,0,this),this.initScrollbarFilmstrip=this.initScrollbarFilmstrip.delay.bind(this.initScrollbarFilmstrip,0,this),this.initScrollbarMosaic=this.initScrollbarMosaic.delay.bind(this.initScrollbarMosaic,0,this),this.initScrollbarHandler=this.initScrollbarHandler.delay.bind(this.initScrollbarHandler,0,this),this.initLargeViewer(),this.lazyLoadImages(),this.lazyLoadIcons()},initLargeViewer:function(){this.large_viewer=new SK.UI.Element.Gallery.LargeViewer(this.getPlaceholder(),{auto_play:this.getProperty("ViewerAutoPlay").toInt(),loop:this.getProperty("ViewerLoop").toInt(),delay:this.getProperty("PopupTransitionDelay").toInt(),zoom:this.getProperty("ViewerZoom").toInt(),lazy_load:this.lazy_loader_large_viewer,lazy_load_buffer:this.large_viewer_buffer_size,display_instance:{isPlaying:this.isPlaying.bind(this),play:this.handlers.play,pause:this.handlers.pause}})},getLargeViewer:function(){return this.large_viewer},createLazyLoaders:function(){this.lazy_loader=new SK.LazyLoader,this.lazy_loader.skip_visible_oninit=!1,window.addEvent("resize",this.updateLazyLoadBuffer.bind(this,this.lazy_loader).throttle(1e3)),this.lazy_loader_icons=new SK.LazyLoader,this.lazy_loader_icons.skip_visible_oninit=!1,this.lazy_loader_large_viewer=new SK.LazyLoader,this.lazy_loader_large_viewer.skip_visible_oninit=!1},updateLazyLoadBuffer:function(t){this.isThumbnails()&&this.lazyLoadImages()},getMaxFullyVisibleImagesCount:function(){if(this.isSlider())return 0;if(!this.isThumbnails())return 1;var t=document.documentElement.clientHeight,e=this.getProperty("ThumbnailHeight");return Math.floor(t/e)},lazyLoadImages:function(){var t=this.getPlaceholder().getElement(".sk-ig-image-gallery .ig-mask, .sk-ig-image-gallery .ig-slide-item");if(t){this.lazy_loader.destroy();var e=this.isSlider()?t.getElements(".sk-ig-ratio-wrapper"):t.getElements(".ig-img");this.lazy_loader.initLazyLoad(e,{scroll_wrapper:t.hasClass("ig-mask")?t:null,buffer_size:this.images_buffer_size,is_scroll_delayed:!this.isSlider(),max_visible_count:this.getMaxFullyVisibleImagesCount()})}},lazyLoadIcons:function(){if(["filmstrip","mosaic"].contains(this.getProperty("GalleryConfigurationType"))){this.lazy_loader_icons.destroy();var t=this.getPlaceholder().getElement(".sk-ig-icon-scroller");this.lazy_loader_icons.initLazyLoad(t.getElementsByTagName("img"),{scroll_wrapper:t,buffer_size:this.icons_buffer_size})}},initEventHandlers:function(){this.handlers={next:this.next.bind(this),prev:this.previous.bind(this),play:this.play.bind(this),pause:this.pause.bind(this),gotoIndex:function(t){this.animateTo(t.target.getAttribute("data-index")||t.target.getElement("[data-index]").getAttribute("data-index"))}.bind(this),hoverNavButton:this.hoverNavButton.bind(this),hoverIconButton:this.hoverIconButton.bind(this),onTransitionComplete:this.onTransitionComplete.bind(this),onDragComplete:this.onDragComplete.bind(this)}},initNavigationEvents:function(){this.placeholder.getElement(".ig-gallery.sk-ig-image-gallery").addEvents({"click:relay(.ig-btn, .ig-icon, .ig-number, .ig-dot)":function(t){t.stopPropagation()},"click:relay(.ig-prev)":this.handlers.prev,"click:relay(.ig-next)":this.handlers.next,"click:relay(.ig-play)":this.handlers.play,"click:relay(.ig-pause)":this.handlers.pause,"click:relay(.ig-icongrid .ig-icon)":this.handlers.gotoIndex,"click:relay(.ig-nav .ig-number)":this.handlers.gotoIndex,"click:relay(.ig-nav .ig-dot)":this.handlers.gotoIndex,"mouseover:relay(.ig-prev)":this.handlers.prev,"mouseout:relay(.ig-prev)":this.handlers.prev,"mousedown:relay(.ig-prev)":this.handlers.prev,"mouseup:relay(.ig-prev)":this.handlers.prev,"mouseover:relay(.ig-next)":this.handlers.next,"mouseout:relay(.ig-next)":this.handlers.next,"mousedown:relay(.ig-next)":this.handlers.next,"mouseup:relay(.ig-next)":this.handlers.next,"mouseover:relay(.ig-play)":this.handlers.hoverNavButton,"mouseout:relay(.ig-play)":this.handlers.hoverNavButton,"mouseover:relay(.ig-pause)":this.handlers.hoverNavButton,"mouseout:relay(.ig-pause)":this.handlers.hoverNavButton,"mouseover:relay(.ig-icongrid .ig-icon)":this.handlers.hoverIconButton,"mouseout:relay(.ig-icongrid .ig-icon)":this.handlers.hoverIconButton}),this.placeholder.getElement(".sk-ig-image-gallery .sk-ig-scroll-container").addEvent("scroll",this.toggleSliderButtonsState.bind(this)),"ontouchstart"in document.documentElement&&this.placeholder.getElement(".sk-ig-image-gallery .ig-thumbs").addEvent("swipe",this.handleSwipeEvent.bind(this))},initScrollbars:function(){this.reinitScrollbarSlider(),this.reinitScrollbarFilmstrip(),this.reinitScrollbarMosaic()},initScrollbarSlider:function(){this.isSlider()&&this.getProperty("GalleryScrollbar").toInt()?(this.scrollbar_slider=new SK.UI.Scrollbar(this.placeholder.getElement(".ig-mask, .ig-slide-item"),{horizontal:!0,vertical:!1,buttons:!0,track:!0,prevent_position:!0}),this.scrollbar_slider.addEvent("dragstart",function(){this.setWasPlayed(this.is_playing),this.is_playing&&this.pause(),this.scrollbar_slider.addEvent("dragcomplete",this.handlers.onDragComplete)}.bind(this))):this.destroyScrollbarSlider()},onDragComplete:function(){this.getWasPlayed()&&this.play(),this.setWasPlayed(!1),this.scrollbar_slider.removeEvent("dragcomplete",this.handlers.onDragComplete)},destroyScrollbarSlider:function(){this.scrollbar_slider&&this.scrollbar_slider.destroy()},reinitScrollbarSlider:function(){this.destroyScrollbarSlider(),this.initScrollbarSlider()},initScrollbarFilmstrip:function(){if("filmstrip"==this.getProperty("GalleryConfigurationType")&&this.getProperty("GalleryScrollbar").toInt()){var t=this.placeholder.getElement(".ig-icongrid"),e=t.hasClass("ig-horizontal"),i=t.hasClass("ig-vertical");this.scrollbar_filmstrip||(this.scrollbar_filmstrip=new SK.UI.Scrollbar(t.getElement(".sk-ig-icon-scroller"),{horizontal:e,vertical:i,buttons:!0,track:!0,prevent_position:!0}))}else this.destroyScrollbarFilmstrip()},destroyScrollbarFilmstrip:function(){this.scrollbar_filmstrip&&(this.scrollbar_filmstrip.destroy(),this.scrollbar_filmstrip=null)},reinitScrollbarFilmstrip:function(){this.destroyScrollbarFilmstrip(),this.initScrollbarFilmstrip()},initScrollbarMosaic:function(){"mosaic"==this.getProperty("GalleryConfigurationType")&&["icons-left","icons-right"].contains(this.getProperty("GalleryVariant"))?this.scrollbar_mosaic||(this.scrollbar_mosaic=new SK.UI.Scrollbar(this.placeholder.getElement(".sk-ig-icon-scroller"),{horizontal:!1,vertical:!0,buttons:!0,track:!0,prevent_position:!0})):this.destroyScrollbarMosaic()},destroyScrollbarMosaic:function(){this.scrollbar_mosaic&&(this.scrollbar_mosaic.destroy(),this.scrollbar_mosaic=null)},reinitScrollbarMosaic:function(){this.destroyScrollbarMosaic(),this.initScrollbarMosaic()},initScrollbarHandler:function(){if("filmstrip"==this.getProperty("GalleryConfigurationType")&&!this.getProperty("GalleryScrollbar").toInt()){this.scroll_handler_filmstrip&&this.destroyScrollbarHandler();var t=this.placeholder.getElement(".sk-ig-icon-scroller"),e=t.getParent(".ig-icongrid").hasClass("ig-horizontal")?"horizontal":"vertical";this.scroll_handler_filmstrip=new SK.UI.Element.Gallery.MousePointerScrollHandler({container:t,mode:e,restarea:"horizontal"==e?this.getProperty("GalleryIconSizeWidth").toInt()/2:this.getProperty("GalleryIconSizeHeight").toInt()/2})}},destroyScrollbarHandler:function(){this.scroll_handler_filmstrip&&(this.scroll_handler_filmstrip.destroy(),this.scroll_handler_filmstrip=null)},initTransitions:function(){if(this.placeholder.getElement(".ig-gallery.sk-ig-image-gallery").removeClass("ig-gallery-loading"),!this.isThumbnails())if(this.initTransitionsManager(),this.getProperty("GalleryAutoplay").toInt())this.play();else{var t=this.placeholder.getElement(".sk-ig-image-gallery .ig-pause");t&&t.setStyle("display","none")}},initTransitionsManager:function(){this.setTransitionItems(),this.transitions_manager=new SK.UI.Element.Gallery.Transitions(this.items,this.placeholder.getElement(".sk-ig-image-gallery .ig-mask, .sk-ig-image-gallery .ig-slide-item"),Object.append({},this.options,{loop:this.getProperty("GalleryLoop").toInt(),transition_type:this.getTransitionType()})),this.gotoIndex(this.options.start_at),this.initScrollbars(),this.initScrollbarHandler(),this.initNavigationEvents()},setTransitionItems:function(){this.items=this.placeholder.getElement(".sk-ig-image-gallery").getElementsByClassName("ig-transition-item")},setupTransitionItems:function(){if(!this.isThumbnails()){var t=this.getTransitionsManager();t&&t.setupTransitionItems({loop:this.getProperty("GalleryLoop").toInt()})}},getTransitionsManager:function(){return this.transitions_manager},setAnimation:function(){if(this.isThumbnails())return this.destroyScrollbarSlider(),void this.removeAnimation();this.transitions_manager?(this.getTransitionsManager().setTransition(this.getTransitionType()),this.env.selected_index(this.getCurrentIndex()),this.initScrollbars()):this.initTransitionsManager()},removeAnimation:function(){var t=this.getTransitionsManager();t&&t.removeCurrentTransition(),this.pause()},getCurrentIndex:function(){return this.getTransitionsManager().getCurrentIndex()},gotoIndex:function(t){this.env.selected_index(t),this.isThumbnails()||(this.stopAutoplay(),this.isAnimatedSlideshow()?this.animateCurrentCaption(t):this.getTransitionsManager().gotoIndex(t),this.runAutoplay())},gotoLastImage:function(){this.isThumbnails()||this.gotoIndex(this.getTransitionsManager().getLastIndex())},gotoLastIcon:function(){var t=this.getProperty("GalleryConfigurationType");["filmstrip","mosaic"].contains(t)&&("mosaic"==t&&["top","bottom"].contains(this.getProperty("GalleryVariant"))||(this.placeholder.getElement(".sk-ig-image-gallery .sk-ig-icon-scroller")[this.env.icongrid_css()["ig-horizontal"]?"scrollLeft":"scrollTop"]=999999))},animateTo:function(t){t!=this.getCurrentIndex()&&(this.stopAutoplay(),this.isAnimatedSlideshow()?this.animateCaptionOut(this.getCurrentIndex(),function(){this.getTransitionsManager().animateTo(t,this.animateCaptionIn.bind(this,t,this.handlers.onTransitionComplete.bind(this)))}.bind(this)):(this.getTransitionsManager().animateTo(t,this.handlers.onTransitionComplete),this.runAutoplay()))},animateToLeft:function(t){t=t||this.speed_factor,this.getTransitionsManager().animateToLeft({speed_factor:t,loop:this.getProperty("GalleryLoop").toInt()},function(){})},animateToRight:function(t){t=t||this.speed_factor,this.getTransitionsManager().animateToRight({speed_factor:t,loop:this.getProperty("GalleryLoop").toInt()},function(){})},stopSliderTransition:function(){this.getTransitionsManager().stopTransition()},onTransitionComplete:function(){this.env.selected_index(this.getCurrentIndex())},next:function(t){if(this.getProperty("GalleryLoop").toInt()||!this.is_playing||this.getCurrentIndex()!=this.getTransitionsManager().getLastIndex()){["mouseover","mouseout"].contains((t=t||{}).type)&&this.hoverNavButton(t);var e=this.isSlider();if(e||!["mouseover","mouseout","mousedown","mouseup"].contains(t.type))if(e)switch(t.type){case"mouseover":!this.is_playing&&this.animateToRight();break;case"mouseout":!this.is_playing&&this.stopSliderTransition();break;case"mousedown":this.animateToRight(2*this.speed_factor);break;case"mouseup":this.stopSliderTransition(),this.animateToRight()}else this.stopAutoplay(),this.animateToNext(),this.runAutoplay()}else this.pause()},animateToNext:function(){if(this.isAnimatedSlideshow()){var t=this.getCurrentIndex();this.animateCaptionOut(t,function(){this.getTransitionsManager().animateToNext(this.animateCaptionIn.bind(this,t+1,this.handlers.onTransitionComplete.bind(this)))}.bind(this))}else this.getTransitionsManager().animateToNext(this.handlers.onTransitionComplete)},previous:function(t){["mouseover","mouseout"].contains((t=t||{}).type)&&this.hoverNavButton(t);var e=this.isSlider();if(e||!["mouseover","mouseout","mousedown","mouseup"].contains(t.type))if(e)switch(t.type){case"mouseover":!this.is_playing&&this.animateToLeft();break;case"mouseout":!this.is_playing&&this.stopSliderTransition();break;case"mousedown":this.animateToLeft(2*this.speed_factor);break;case"mouseup":this.stopSliderTransition(),this.is_playing?this.animateToRight():this.animateToLeft()}else{if(this.stopAutoplay(),this.isAnimatedSlideshow()){var i=this.getCurrentIndex();this.animateCaptionOut(i,function(){this.getTransitionsManager().animateToPrevious(this.animateCaptionIn.bind(this,i-1,this.handlers.onTransitionComplete.bind(this)))}.bind(this))}else this.getTransitionsManager().animateToPrevious(this.handlers.onTransitionComplete);this.runAutoplay()}},play:function(t){if(!SK.Singletons.env.get("admin_mode")||!this.env.editing_activated()){this.is_playing=!0;var e=this.placeholder.getElement(".sk-ig-image-gallery .ig-play"),i=this.placeholder.getElement(".sk-ig-image-gallery .ig-pause");e&&e.setStyle("display","none"),i&&i.setStyle("display",""),this.isSlider()?this.animateToRight():(t&&this.animateToNext(),this.runAutoplay())}},pause:function(){this.is_playing=!1;var t=this.placeholder.getElement(".sk-ig-image-gallery .ig-play"),e=this.placeholder.getElement(".sk-ig-image-gallery .ig-pause");t&&t.setStyle("display",""),e&&e.setStyle("display","none"),this.isSlider()?this.stopSliderTransition():this.stopAutoplay()},stopAutoplay:function(){clearInterval(this.autoplay)},runAutoplay:function(){if(this.is_playing){var t=0==this.getProperty("SlideTransitionDelay")?this.getDefaultProperty("SlideTransitionDelay"):this.getProperty("SlideTransitionDelay");this.autoplay=this.next.periodical(1e3*t,this)}},getWasPlayed:function(){return this.was_played},setWasPlayed:function(t){this.was_played=t},isPlaying:function(){return this.is_playing},getSlideCaptionData:function(t){t=SK.UI.Element.Gallery.Transitions.Utils.getCorrectIndex(t,this.items);var e=this.env.image_list?this.env.image_list():SK.Util.decodeJSON(this.getProperty("Images"));return{element:this.items[t].getElement(this.caption_selector),transition:SK.Util.decodeJSON((Function.from(e[t].CaptionAnimation)()||"").trim()||this.getProperty("CaptionAnimation")||this.getDefaultProperty("CaptionAnimation")),offset:{left:(Function.from(e[t].CaptionOffsetLeft)()||this.getProperty("CaptionOffsetLeft")||this.getDefaultProperty("CaptionOffsetLeft "))/100,top:(Function.from(e[t].CaptionOffsetTop)()||this.getProperty("CaptionOffsetTop")||this.getDefaultProperty("CaptionOffsetTop"))/100}}},animateCaptionOut:function(t,e){e=e||function(){};var i=this.getSlideCaptionData(t);SK.UI.Element.Gallery.TransitionsCaptionManager.animateOut(i,e)},animateCaptionIn:function(t,e){e=e||function(){};var i=this.getSlideCaptionData(t);SK.UI.Element.Gallery.TransitionsCaptionManager.animateIn(i,e)},instantCaptionOut:function(t){SK.UI.Element.Gallery.TransitionsCaptionManager.instantOut(this.getSlideCaptionData(t))},animateCurrentCaption:function(t){this.instantCaptionOut(this.getCurrentIndex()),this.getTransitionsManager().gotoIndex(t),this.animateCaptionIn(t,function(){})},handleSwipeEvent:function(t){if(!this.isThumbnails()&&!this.isSlider()){var e=this.getTransitionsManager();if("right"!=t.direction)(this.getProperty("GalleryLoop").toInt()||e.getCurrentIndex()!=e.getLastIndex())&&this.handlers.next();else{if(!this.getProperty("GalleryLoop").toInt()&&e.getCurrentIndex()==e.getFirstIndex())return;this.handlers.prev()}}},isThumbnails:function(){return"thumbnails"==this.getProperty("GalleryConfigurationType")},isAnimatedSlideshow:function(){return"slideshow"==this.getProperty("GalleryConfigurationType")&&"animated_captions"==this.getProperty("GalleryVariant")},isSlider:function(){return"slider"==this.getProperty("GalleryConfigurationType")},resetSliderPosition:function(){this.placeholder.getElement(".ig-mask").scrollLeft=0},disableSkipInPreview:function(){this.placeholder.getElement(".ig-gallery").removeClass("sk-skip-in-preview")},getTransitionType:function(){return this.isSlider()?this.getProperty("GalleryConfigurationType"):this.getProperty("SlideTransitionType")},isKnockoutUsageSafe:function(){return!0},hoverNavButton:function(t){t.target.toggleClass("ig-over")},hoverIconButton:function(t){var e=t.target.getParent(".ig-icon");e&&e.toggleClass("ig-over")},toggleSliderButtonsState:function(){if(this.isSlider()&&!this.getProperty("GalleryLoop").toInt()){var t=this.placeholder.getElement(".ig-mask");this.placeholder.getElements(".sk-ig-image-gallery .ig-prev").toggleClass("ig-disabled",0==t.scrollLeft),this.placeholder.getElements(".sk-ig-image-gallery .ig-next").toggleClass("ig-disabled",t.scrollLeft+t.getWidth()==t.scrollWidth)}},isCssEnabled:function(t,e){return!!this.placeholder.getElement(".sk-ig-image-gallery").hasClass("ig-empty-placeholder")||!("original"!==t&&!this.detector.isClipPathSupported())&&(!("reflection"===e&&!this.detector.isBoxReflectSupported())&&this.detector.isFilterSupported())},cssClipPath:function(t,e,i){return this.isCssEnabled(e,i)?new(SK.UI.Element.Gallery.Shapes[e.capitalize()])(t.offsetWidth,t.offsetHeight).getCss():{}},cssPanZoom:function(t,e,i,n,s,r){return this.isCssEnabled(e,i)?["transform: scale(",n,") translate(",100*s/t.naturalWidth,"%, ",100*r/t.naturalHeight,"%)"].join(""):""},cssClass:function(t,e,i,n,s){Math.round(t.getWidth()),e.getWidth(),Math.round(t.getHeight()),e.getHeight();return["effect-"+n,"0"==s||"slider"==this.getProperty("GalleryConfigurationType")?"nocrop":"crop",this.isCssEnabled(i,n)?"css-mode":"canvas-mode",t.naturalHeight/t.naturalWidth>e.offsetHeight/e.offsetWidth&&"slider"!=this.getProperty("GalleryConfigurationType")?"greater-ratio":"lesser-ratio"].join(" ")},drawImage:function(t,e,i){var n=t.getElement(".sk-ig-clip-wrapper img"),s=n.retrieve("canvas:instance");s&&s.destroy(),n.naturalWidth&&n.naturalHeight&&!i?this.drawImageWhenLoaded(n,t,e):n.onload=this.drawImageWhenLoaded.bind(this,n,t,e)},drawImageWhenLoaded:function(t,e,i){if(t.onload=null,e.removeClass("ig-img-loading"),i.shape&&i.effect){var n=e.getElement(".sk-ig-slider-spacer"),s="slider"==i.type?e.getElement(".sk-ig-dimensions-wrapper").getStyle("width").toInt():parseInt(i.width,10),r=100*("slider"==i.type&&this.env.images.data().length&&n?n.getHeight():parseInt(i.height,10))/s,a=e.getElement(".sk-ig-ratio-wrapper").setStyle("padding-bottom",r+"%");e.getElement(".sk-ig-effect-wrapper").setAttribute("class","sk-ig-effect-wrapper "+this.cssClass(t,a,i.shape,i.effect,i.crop));var o=e.getElement(".sk-ig-clip-wrapper");o.setStyles(this.cssClipPath(o,i.shape,i.effect)),t.setAttribute("style",this.cssPanZoom(t,i.shape,i.effect,1,0,0)),this.isCssEnabled(i.shape,i.effect)||("ie"==Browser.name&&"original"==i.shape?this.drawCanvas.delay(0,this,[t,i]):this.drawCanvas(t,i)),this.isSlider()&&this.getProperty("GalleryLoop").toInt()&&(this.setupTransitionItems.delay(0,this),this.isPlaying()&&this.animateToRight())}},drawCanvas:function(t,e){var i=t.getParent(".sk-ig-dimensions-wrapper");i.offsetWidth&&i.offsetHeight&&(new SK.UI.Element.Gallery.Canvas(t,{shape:this.getProperty("GalleryThumbnailShape"),effect:this.getProperty("GalleryThumbnailEffect"),zoom:1,offsetx:0,offsety:0,crop:this.isSlider()||!this.env.images.data().length?0:e.crop,is_icon:e.is_icon,align:{thumbnails:"bottom",slider:"top"}[e.type]||"middle"}).draw(),"ie"==Browser.name&&t.getParent(".sk-ig-effect-wrapper").addClass("sk-ig-ie-canvas-fix"))},startEdit:function(){this.parent.apply(this,arguments),this.is_playing&&(this.setWasPlayed(!0),this.pause())},cancelEdit:function(){this.parent.apply(this,arguments),this.closePropertyPanel()},finishEdit:function(){this.parent.apply(this,arguments),this.closePropertyPanel()},closePropertyPanel:function(){if(!this.isThumbnails()&&this.getWasPlayed())this.play(),this.setWasPlayed(!1);else{var t=this.placeholder.getElement(".sk-ig-image-gallery .ig-pause");t&&t.setStyle("display","none")}}}),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.FeaturesDetector=SK.UI.Element.Gallery.FeaturesDetector||new Class({cache:{},testProperty:function(t,e){if(this.cache.hasOwnProperty(t))return this.cache[t];var i=document.createElement("div"),n=["webkit"].reduce(function(e,i){return e.concat(i+t.charAt(0).toUpperCase()+t.slice(1))},[t]);function s(t){return i.style[a]=t,""!==i.style[a]}for(var r=0;r<n.length;r++){var a=n[r];if(""===i.style[a]&&e.every(s))return this.cache[t]=!0}return this.cache[t]=!1},isClipPathSupported:function(){return this.testProperty("clipPath",["circle()","ellipse(50% 40% at 50% 50%)","polygon(30% 0%, 70% 0%, 100% 30%, 100% 70%, 70% 100%, 30% 100%, 0% 70%, 0% 30%)","polygon(50% 0%, 75% 50%, 50% 100%, 25% 50%)"])},isFilterSupported:function(){return this.testProperty("filter",["grayscale(100%)","brightness(150%)","url(#dark)","sepia(100%)","blur(2px)"])},isBoxReflectSupported:function(){return this.testProperty("boxReflect",["below 0px linear-gradient(to bottom, transparent, transparent 70%, rgba(250, 250, 250, .2))"])}}),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.Filters=SK.UI.Element.Gallery.Filters||{none:function(t){return t},polaroid:function(t){return t},sepia:function(t){for(var e=t.data,i=0;i<e.length;i+=4){var n=e[i],s=e[i+1],r=e[i+2];e[i]=.393*n+.769*s+.189*r,e[i+1]=.349*n+.686*s+.168*r,e[i+2]=.272*n+.534*s+.131*r}return t},grayscale:function(t){for(var e=t.data,i=0;i<e.length;i+=4){var n=e[i],s=e[i+1],r=e[i+2];e[i]=e[i+1]=e[i+2]=(n+s+r)/3}return t},light:function(t){for(var e=t.data,i=0;i<e.length;i+=4)e[i]*=1.5,e[i+1]*=1.5,e[i+2]*=1.5;return t},dark:function(t){for(var e=t.data,i=0;i<e.length;i+=4)e[i]-=50,e[i+1]-=50,e[i+2]-=50;return t},reflection:function(t,e,i,n,s,r,a,o){var l=document.createElement("canvas"),h=document.createElement("canvas"),c=0,g=0,p=0;switch(o=o||"middle",a&&s>t.height&&(n=t.width,s=t.height,e=0,i=0),h.width=Math.min(n,t.width),h.height=.3*s,l.width=t.width,o){case"bottom":l.height=t.height+h.height,p=(t.height-s)/2,c=t.height-h.height,g=t.height;break;case"top":l.height=Math.max(t.height,i+s+h.height),p=-i,c=s-h.height,g=s;break;default:l.height=Math.max(t.height,i+s+h.height),p=0,c=i+s-h.height,g=i+s}var d=l.getContext("2d"),m=h.getContext("2d");d.putImageData(t,0,p),m.translate(0,h.height),m.scale(1,-1),m.drawImage(l,Math.max(e,0),c,h.width,h.height,0,0,h.width,h.height),m.setTransform(1,0,0,1,0,0);var u=m.createLinearGradient(0,0,0,h.height);return u.addColorStop(0,"rgba(0, 0, 0, .6)"),u.addColorStop(1,"rgba(0, 0, 0, 1)"),m.globalCompositeOperation="destination-out",m.fillStyle=u,m.fillRect(0,0,h.width,h.height),d.drawImage(h,Math.max(e,0),g),t=d.getImageData(0,0,l.width,l.height),l.destroy(),h.destroy(),t}},SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.Shapes=SK.UI.Element.Gallery.Shapes||new Class({initialize:function(t,e,i,n){this.containerWidth=t,this.containerHeight=e,this.imageWidth=Math.min(t,i),this.imageHeight=Math.min(e,n)},polygon:function(t,e,i,n,s){for(var r=[],a=0;a<t;a++)r.push({x:e*Math.cos(2*Math.PI*a/t+s)+i,y:e*Math.sin(2*Math.PI*a/t+s)+n});return r},cssPolygon:function(t,e){var i=Math.min(this.containerWidth,this.containerHeight)/this.containerWidth,n=Math.min(this.containerWidth,this.containerHeight)/this.containerHeight;return"polygon("+this.polygon(t,50,50,50,e).map(function(t){return i*(t.x-50)+50+"% "+(n*(t.y-50)+50)+"%"}).join(", ")+")"},canvasPolygon:function(t,e,i){var n=this.polygon(e,Math.min(this.imageWidth,this.imageHeight)/2,this.containerWidth/2,this.containerHeight/2,i);t.moveTo(n[0].x,n[0].y);for(var s=1;s<n.length;s++)t.lineTo(n[s].x,n[s].y);t.closePath()},getCss:function(){var t=this.cssShape();return{"clip-path":t,"-webkit-clip-path":t}},clipMask:function(t){t.beginPath(),this.canvasShape(t),t.fillStyle="black",t.fill()},canvasShape:function(t){},cssShape:function(){}}),SK.UI.Element.Gallery.Shapes.Original=SK.UI.Element.Gallery.Shapes.Original||new Class({Extends:SK.UI.Element.Gallery.Shapes,cssShape:function(){return"none"},clipMask:function(){}}),SK.UI.Element.Gallery.Shapes.Circle=SK.UI.Element.Gallery.Shapes.Circle||new Class({Extends:SK.UI.Element.Gallery.Shapes,cssShape:function(){return"circle()"},canvasShape:function(t){t.arc(this.containerWidth/2,this.containerHeight/2,Math.min(this.imageWidth,this.imageHeight)/2,0,2*Math.PI)}}),SK.UI.Element.Gallery.Shapes.Ellipse=SK.UI.Element.Gallery.Shapes.Ellipse||new Class({Extends:SK.UI.Element.Gallery.Shapes,cssShape:function(){return"ellipse(50% 40% at 50% 50%)"},canvasShape:function(t){t.ellipse?t.ellipse(this.containerWidth/2,this.containerHeight/2,this.imageWidth/2,.4*this.imageHeight,2*Math.PI,0,2*Math.PI):(t.scale(1.5,1),t.beginPath(),t.arc(this.containerWidth/3,this.containerHeight/2,this.containerHeight/2.5,0,2*Math.PI,!1),t.restore())}}),SK.UI.Element.Gallery.Shapes.Diamond=SK.UI.Element.Gallery.Shapes.Diamond||new Class({Extends:SK.UI.Element.Gallery.Shapes,cssShape:function(){return this.cssPolygon(4,0)},canvasShape:function(t){this.canvasPolygon(t,4,0)}}),SK.UI.Element.Gallery.Shapes.Hexagon=SK.UI.Element.Gallery.Shapes.Hexagon||new Class({Extends:SK.UI.Element.Gallery.Shapes,cssShape:function(){return this.cssPolygon(6,Math.PI/2)},canvasShape:function(t){this.canvasPolygon(t,6,Math.PI/2)}}),SK.UI.Element.Gallery.Shapes.Octagon=SK.UI.Element.Gallery.Shapes.Octagon||new Class({Extends:SK.UI.Element.Gallery.Shapes,cssShape:function(){return this.cssPolygon(8,0)},canvasShape:function(t){this.canvasPolygon(t,8,0)}}),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.Canvas=SK.UI.Element.Gallery.Canvas||new Class({Implements:Options,options:{shape:"original",effect:"none",zoom:1,offsetx:0,offsety:0,crop:!1,is_icon:!1,align:"middle"},initialize:function(t,e){this.setOptions(e);var i=t.retrieve("canvas:instance");i&&i.destroy(),this.canvas=t.parentNode.insertBefore(document.createElement("canvas"),t),this.context=this.canvas.getContext("2d"),this.canvas.width=1==e.crop?t.getParent(".sk-ig-dimensions-wrapper").offsetWidth:t.width,this.canvas.height=1==e.crop?t.getParent(".sk-ig-dimensions-wrapper").offsetHeight:t.height,t.hasAttribute("data-index")&&this.canvas.setAttribute("data-index",t.getAttribute("data-index")),t.style.display="none",this.image=t,t.store("canvas:instance",this)},draw:function(){var t=this.canvas.width/this.image.width,e=this.canvas.height/this.image.height,i=(parseInt(this.options.crop,10)?Math.max:Math.min).call(this,t,e);this.canvas.width>=this.image.width&&this.canvas.height>=this.image.height&&!parseInt(this.options.crop,10)&&(i=1);var n=(this.canvas.width-this.image.width*i)/2,s=(this.canvas.height-this.image.height*i)/2;this.dimensions={x:n,y:s,width:this.image.width*i,height:this.image.height*i},this.context.drawImage(this.image,this.image.width*(1-1/this.options.zoom)/2-this.options.offsetx,this.image.height*(1-1/this.options.zoom)/2-this.options.offsety,this.image.width/this.options.zoom,this.image.height/this.options.zoom,n,"top"==this.options.align&&"original"==this.options.shape&&"none"==this.options.effect?0:s,this.image.width*i,this.image.height*i),this.applyShape(this.options.shape),this.applyFilter(this.options.effect)},applyShape:function(t){this.context.globalCompositeOperation="destination-in",new(SK.UI.Element.Gallery.Shapes[t.capitalize()])(this.canvas.width,this.canvas.height,this.dimensions.width,this.dimensions.height).clipMask(this.context)},applyFilter:function(t){var e=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),i=SK.UI.Element.Gallery.Filters[t](e,this.dimensions.x,this.dimensions.y,this.dimensions.width,this.dimensions.height,this.options.is_icon,"1"==this.options.crop,this.options.align);this.canvas.height=Math.max(this.canvas.height,i.height),this.canvas.width=Math.max(this.canvas.width,i.width),this.context.putImageData(i,0,0)},destroy:function(){this.image.style.display="",this.image.eliminate("canvas:instance"),this.canvas.destroy()}}),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.Transitions=SK.UI.Element.Gallery.Transitions||new Class({Implements:[Options],current_index:null,items:null,container:null,transition:null,initialize:function(t,e,i){this.items=t,this.container=e,this.setOptions(i),this.setTransition(this.options.transition_type)},setupTransitionItems:function(t){t=t||{},this.transition.setup(new Elements(this.items),this.container,Object.append({},this.options,t))},setTransition:function(t){this.removeCurrentTransition(),this.transition=SK.UI.Element.Gallery.Transitions.Registry.get(t),this.setupTransitionItems(),this.items.length&&this.getCurrentIndex()>this.getLastIndex()?this.gotoIndex(this.getLastIndex()):this.gotoIndex(this.getCurrentIndex())},gotoIndex:function(t){this.current_index=t,this.transition.gotoIndex(this.current_index,new Elements(this.items),this.container)},animateTo:function(t,e){var i=SK.UI.Element.Gallery.Transitions.Utils.getCorrectIndex(t,this.items);i!=this.getCurrentIndex()&&this.transition.animateTo(this.current_index,t,new Elements(this.items),this.container,function(){this.current_index=i,e()}.bind(this))},gotoFirst:function(){this.gotoIndex(this.getFirstIndex())},gotoLast:function(){this.gotoIndex(this.getLastIndex())},animateToFirst:function(t){this.animateTo(this.getFirstIndex(),t)},animateToLast:function(t){this.animateTo(this.getLastIndex(),t)},animateToPrevious:function(t){this.animateTo(this.getPreviousIndex(),t)},animateToNext:function(t){this.animateTo(this.getNextIndex(),t)},animateToRight:function(t,e){this.stopTransition(),this.transition.animateToRight(this.container,t,e)},animateToLeft:function(t,e){this.stopTransition(),this.transition.animateToLeft(this.container,t,e)},stopTransition:function(){this.transition.stop(this.container)},getFirstIndex:function(){return 0},getPreviousIndex:function(){return this.getCurrentIndex()-1},getNextIndex:function(t){return this.getCurrentIndex()+1},getLastIndex:function(){return this.items.length-1},getCurrentIndex:function(){return this.current_index||0},removeCurrentTransition:function(){this.transition&&(this.transition.reset(new Elements(this.items),this.container),this.items.length&&this.getCurrentIndex()>this.getLastIndex()&&this.gotoIndex(this.getLastIndex()))}}),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.Transitions=SK.UI.Element.Gallery.Transitions||{},SK.UI.Element.Gallery.Transitions.Registry={data:{},get:function(t){return this.data[t]},set:function(t,e){this.data[t]=e}},SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.Transitions=SK.UI.Element.Gallery.Transitions||{},SK.UI.Element.Gallery.Transitions.Utils=SK.UI.Element.Gallery.Transitions.Utils||{getCorrectIndex:function(t,e){return(e.length+t)%e.length},getScrollWidth:function(t){return t.scrollWidth-t.getWidth()}},SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.Transitions=SK.UI.Element.Gallery.Transitions||{},SK.UI.Element.Gallery.Transitions.Fade=SK.UI.Element.Gallery.Transitions.Fade||{css_class:"ig-transition-fade",css_class_clone:"ig-transition-fade-clone",mgr_selector:".ig-transition-mgr",setup:function(t,e,i){t.filter(":not(."+this.css_class+")").addClass(this.css_class).set("tweenCSS3",i.fx).store("tween_options",i.fx)},animateTo:function(t,e,i,n,s){var r=i[e=SK.UI.Element.Gallery.Transitions.Utils.getCorrectIndex(e,i)].get("tweenCSS3");if(!r.isRunning()){var a=n.getElement(this.mgr_selector),o=i[t],l=o.clone(!0).addClass(this.css_class_clone).removeClass(this.css_class).inject(n).set("tweenCSS3",o.retrieve("tween_options"));o.setStyle("visibility",""),o.style.opacity="";var h=function(){r.removeEvent("complete",h),l.destroy(),s()};r.addEvent("complete",h),a.setStyle("margin-left",SK.Util.toPercent(-e)),l.tweenCSS3("opacity",0),i[e].setStyle("visibility","visible").tweenCSS3("opacity",1)}},gotoIndex:function(t,e,i){for(var n=i.getElement(this.mgr_selector),s=0;s<e.length;s++)s!=t&&1==e[s].getStyle("opacity")&&(e[s].setStyle("visibility",""),e[s].style.opacity="");e[t].setStyles({visibility:"visible",opacity:1}),n.setStyle("margin-left",SK.Util.toPercent(-t))},reset:function(t,e){t.erase("tweenCSS3").eliminate("tween_options").removeClass(this.css_class).setStyle("visibility",""),e.getElement(this.mgr_selector).setStyle("margin-left","");for(var i=0;i<t.length;i++)t[i].style.opacity=""}},SK.UI.Element.Gallery.Transitions.Registry.set("fade",SK.UI.Element.Gallery.Transitions.Fade),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.Transitions=SK.UI.Element.Gallery.Transitions||{},SK.UI.Element.Gallery.Transitions.None=SK.UI.Element.Gallery.Transitions.None||Object.append({},SK.UI.Element.Gallery.Transitions.Fade,{setup:function(t,e){SK.UI.Element.Gallery.Transitions.Fade.setup(t,e,{fx:{duration:1}})}}),SK.UI.Element.Gallery.Transitions.Registry.set("none",SK.UI.Element.Gallery.Transitions.None),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.Transitions=SK.UI.Element.Gallery.Transitions||{},SK.UI.Element.Gallery.Transitions.Slide=SK.UI.Element.Gallery.Transitions.Slide||{mgr_selector:".ig-transition-mgr",setup:function(t,e,i){e.getElement(this.mgr_selector).set("tween",i.fx)},animateTo:function(t,e,i,n,s){var r=SK.UI.Element.Gallery.Transitions.Utils.getCorrectIndex(e,i),a=n.getElement(this.mgr_selector),o=a.get("tween");if(!o.isRunning()){var l=function(){o.removeEvent("complete",l),e<0&&(i[r].inject(n),a.setStyle("margin-left",SK.Util.toPercent(-r))),e==i.length&&(i[r].inject(a,"after"),a.setStyle("margin-left","")),s()};if(o.addEvent("complete",l),e<0)return i[r].inject(a,"after"),void a.setStyle("margin-left",SK.Util.toPercent(e)).tween("margin-left",SK.Util.toPercent(e),"");if(e!=i.length)a.tween("margin-left",a.getStyle("margin-left"),SK.Util.toPercent(-e));else{i[r].inject(n);var h=a.getStyle("margin-left"),c=SK.Util.toPercent(SK.Util.fromPercent(a.getStyle("margin-left"))+1);a.setStyle("margin-left",c).tween("margin-left",c,h)}}},gotoIndex:function(t,e,i){t=SK.UI.Element.Gallery.Transitions.Utils.getCorrectIndex(t,e),i.getElement(this.mgr_selector).setStyle("margin-left",SK.Util.toPercent(-t))},reset:function(t,e){e.getElement(this.mgr_selector).erase("tween").setStyle("margin-left","")}},SK.UI.Element.Gallery.Transitions.Registry.set("slide",SK.UI.Element.Gallery.Transitions.Slide),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.Transitions=SK.UI.Element.Gallery.Transitions||{},SK.UI.Element.Gallery.Transitions.Slider=SK.UI.Element.Gallery.Transitions.Slider||{constants:{mgr_class:"ig-transition-slider-mgr",items_class:"ig-transition-slider-item",interval_property:"slider:interval",step:{1:2,2:9}},setup:function(t,e,i){if(i.loop){var n=Math.round(t.getWidth().reduce(function(t,e){return t+e},0)),s=e.getWidth();if(n<=s)this._destroyManager(e);else{var r=e.getElement("."+this.constants.mgr_class)||new Element("div",{class:this.constants.mgr_class}).inject(e);this._fillManager(r,t,s)}}else this._destroyManager(e)},_fillManager:function(t,e,i){t.empty();for(var n=0;e.length,i>0;n++){var s=e[n].clone().removeProperty("data-bind").removeClass("ig-transition-item").addClass(this.constants.items_class).inject(t),r=e[n].getElements("canvas");if(r.length)for(var a=s.getElements("canvas"),o=0;o<r.length;o++){var l=document.createElement("canvas");l.width=r[o].width,l.height=r[o].height,l.getContext("2d").drawImage(r[o],0,0),l.replaces(a[o])}i-=e[n].getWidth()}},_destroyManager:function(t){var e=t.getElement("."+this.constants.mgr_class);e&&e.destroy()},animateTo:function(){},animateToRight:function(t,e,i){var n=SK.UI.Element.Gallery.Transitions.Utils.getScrollWidth(t);t.store(this.constants.interval_property,window.requestAnimationFrame(this._animateRight.bind(this,t,e,i,n)))},_animateRight:function(t,e,i,n){e.loop&&Math.floor(t.scrollLeft)>=Math.floor(n)&&(t.scrollLeft=0),t.scrollLeft+=this.constants.step[e.speed_factor],this.animateToRight(t,e,i)},animateToLeft:function(t,e,i){var n=SK.UI.Element.Gallery.Transitions.Utils.getScrollWidth(t);t.store(this.constants.interval_property,window.requestAnimationFrame(this._animateLeft.bind(this,t,e,i,n)))},_animateLeft:function(t,e,i,n){e.loop&&0==t.scrollLeft&&(t.scrollLeft=n),t.scrollLeft-=this.constants.step[e.speed_factor],this.animateToLeft(t,e,i)},stop:function(t){var e=t.retrieve(this.constants.interval_property);e&&(window.cancelAnimationFrame(e),t.eliminate(this.constants.interval_property))},gotoIndex:function(t,e,i){},reset:function(t,e){e.scrollLeft=0,this._destroyManager(e)}},SK.UI.Element.Gallery.Transitions.Registry.set("slider",SK.UI.Element.Gallery.Transitions.Slider),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.TransitionsCaption=SK.UI.Element.Gallery.TransitionsCaption||{},SK.UI.Element.Gallery.TransitionsCaption.Fade=SK.UI.Element.Gallery.TransitionsCaption.Fade||{fx_options:{property:"opacity"},animateIn:function(t,e,i){var n=function(){s.removeEvent("complete",n),i()},s=new Fx.Tween(t,this.fx_options).addEvent("complete",n);t.setStyle("opacity",0),s.start(1)},animateOut:function(t,e,i){var n=function(){t.setStyle("display",""),t.style.opacity="",s.removeEvent("complete",n),i()},s=new Fx.Tween(t,this.fx_options).addEvent("complete",n);s.start(0)}},SK.UI.Element.Gallery.Transitions.Registry.set("caption:fade",SK.UI.Element.Gallery.TransitionsCaption.Fade),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.TransitionsCaption=SK.UI.Element.Gallery.TransitionsCaption||{},SK.UI.Element.Gallery.TransitionsCaption.SlideToLeft=SK.UI.Element.Gallery.TransitionsCaption.SlideToLeft||{fx_options:{property:"left",unit:"%"},animateIn:function(t,e,i){var n=function(){s.removeEvent("complete",n),i()},s=new Fx.Tween(t,this.fx_options).addEvent("complete",n);t.setStyle("left",SK.Util.toPercent(1+e.left.toFloat())),s.start(SK.Util.toPercent(e.left))},animateOut:function(t,e,i){var n=function(){t.setStyles({display:"",left:"",top:""}),s.removeEvent("complete",n),i()},s=new Fx.Tween(t,this.fx_options).addEvent("complete",n);s.start("-"+SK.Util.toPercent(1+e.left.toFloat()))}},SK.UI.Element.Gallery.Transitions.Registry.set("caption:slide:right-left",SK.UI.Element.Gallery.TransitionsCaption.SlideToLeft),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.TransitionsCaption=SK.UI.Element.Gallery.TransitionsCaption||{},SK.UI.Element.Gallery.TransitionsCaption.SlideToRight=SK.UI.Element.Gallery.TransitionsCaption.SlideToRight||{fx_options:{property:"left",unit:"%"},animateIn:function(t,e,i){var n=function(){s.removeEvent("complete",n),i()},s=new Fx.Tween(t,this.fx_options).addEvent("complete",n);t.setStyle("left","-"+SK.Util.toPercent(1+e.left.toFloat())),s.start(SK.Util.toPercent(e.left))},animateOut:function(t,e,i){var n=function(){t.setStyles({display:"",left:"",top:""}),s.removeEvent("complete",n),i()},s=new Fx.Tween(t,this.fx_options).addEvent("complete",n);s.start(SK.Util.toPercent(1+e.left.toFloat()))}},SK.UI.Element.Gallery.Transitions.Registry.set("caption:slide:left-right",SK.UI.Element.Gallery.TransitionsCaption.SlideToRight),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.TransitionsCaption=SK.UI.Element.Gallery.TransitionsCaption||{},SK.UI.Element.Gallery.TransitionsCaption.SlideToTop=SK.UI.Element.Gallery.TransitionsCaption.SlideToTop||{fx_options:{property:"top",unit:"%"},animateIn:function(t,e,i){var n=function(){s.removeEvent("complete",n),i()},s=new Fx.Tween(t,this.fx_options).addEvent("complete",n);t.setStyle("top",SK.Util.toPercent(1+e.top.toFloat())),s.start(SK.Util.toPercent(e.top))},animateOut:function(t,e,i){var n=function(){t.setStyles({display:"",left:"",top:""}),s.removeEvent("complete",n),i()},s=new Fx.Tween(t,this.fx_options).addEvent("complete",n);s.start("-"+SK.Util.toPercent(1+e.top.toFloat()))}},SK.UI.Element.Gallery.Transitions.Registry.set("caption:slide:down-up",SK.UI.Element.Gallery.TransitionsCaption.SlideToTop),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.TransitionsCaption=SK.UI.Element.Gallery.TransitionsCaption||{},SK.UI.Element.Gallery.TransitionsCaption.SlideToBottom=SK.UI.Element.Gallery.TransitionsCaption.SlideToBottom||{fx_options:{property:"top",unit:"%"},animateIn:function(t,e,i){var n=function(){s.removeEvent("complete",n),i()},s=new Fx.Tween(t,this.fx_options).addEvent("complete",n);t.setStyle("top","-"+SK.Util.toPercent(1+e.top.toFloat())),s.start(SK.Util.toPercent(e.top))},animateOut:function(t,e,i){var n=function(){t.setStyles({display:"",left:"",top:""}),s.removeEvent("complete",n),i()},s=new Fx.Tween(t,this.fx_options).addEvent("complete",n);s.start(SK.Util.toPercent(1+e.top.toFloat()))}},SK.UI.Element.Gallery.Transitions.Registry.set("caption:slide:up-down",SK.UI.Element.Gallery.TransitionsCaption.SlideToBottom),SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.TransitionsCaptionManager=SK.UI.Element.Gallery.TransitionsCaptionManager||{transition_status_key:"is_transition_running",transition_registry:SK.UI.Element.Gallery.Transitions.Registry,animateIn:function(t,e){this._executeAnimateMethod(t,e,"animateIn")},animateOut:function(t,e){this._executeAnimateMethod(t,e,"animateOut")},_executeAnimateMethod:function(t,e,i){if(!t.element.retrieve(this.transition_status_key)){var n=t.transition.transitions.length;t.element.setStyles({display:"block",width:SK.Util.toPercent(1-t.offset.left),left:SK.Util.toPercent(t.offset.left),top:SK.Util.toPercent(t.offset.top)}).store(this.transition_status_key,!0);var s=function(){t.element.setStyle("width","").eliminate(this.transition_status_key),e()}.bind(this);if(t.element.get("text").trim())if(1!=n)for(var r=0;r<n;r++)"fade"==t.transition.transitions[r]?this.transition_registry.get("caption:fade")[i](t.element,t.offset,s):this.transition_registry.get("caption:slide:"+t.transition.direction)[i](t.element,t.offset,function(){});else{var a="fade"==t.transition.transitions[0]?"caption:fade":"caption:slide:"+t.transition.direction;this.transition_registry.get(a)[i](t.element,t.offset,s)}else s()}},instantOut:function(t){t.element.removeProperty("style")}},SK="undefined"==typeof SK?{}:SK,SK.UI=SK.UI||{},SK.UI.Element=SK.UI.Element||{},SK.UI.Element.Gallery=SK.UI.Element.Gallery||{},SK.UI.Element.Gallery.LargeViewer=new Class({Implements:[Options],options:{auto_play:0,loop:0,delay:5,zoom:0,lazy_load:null,draw_image:null,display_instance:null},placeholder:null,container:null,handlers:{},items:null,is_playing:!1,is_paused:!1,is_draging:!1,current_zoomed_image:null,transitions_manager:null,is_galllery_playing:!1,animation_duration:600,is_lazy_load_initialized:!1,initialize:function(t,e){this.placeholder=t,this.container=this.placeholder.getElement(".sk-ig-liv-large-image-viewer"),this.setOptions(e),this.init(),this.container.removeClass("ig-gallery-loading")},init:function(){this.viewer_mask=this.container.getElement(".ig-mask"),this.setEventHandlers(),this.hockViewerEvents(),this.initTransitions(),this.hockTransitionsEvents()},setEventHandlers:function(){this.handlers={keydown:this.onKeydown.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),hide_with_delay:null,show_with_delay:null,autoplay:null,play:this.play.bind(this),pause:this.pause.bind(this),prev:this.prev.bind(this),next:this.next.bind(this),prevent:this.prevent.bind(this),over:this.onHoverNavButton.bind(this,!0),out:this.onHoverNavButton.bind(this,!1),transition_complete:this.onTransitionComplete.bind(this),set_zoom:this.toggleZoom.bind(this,!1),drag:this.setDragState.bind(this,!0),complete:this.setDragState.delay.bind(this.setDragState,0,this,[!1]),image_wrapper_size:this.setImageWrapperSize.bind(this)}},isEditMode:function(){return!SK.Singletons.env.get("admin_mode")||(SK.UI.Preview||{}).isEnabled},initTransitions:function(){this.setTransitionItems(),this.items.length&&(this.transitions_manager=new SK.UI.Element.Gallery.Transitions(this.items,this.viewer_mask,{fx:{duration:500,link:"chain",unit:"%"},loop:0,transition_type:"fade",start_at:0,timeout:500}))},setTransitionItems:function(){this.items=this.container.getElementsByClassName("ig-transition-item")},hockTransitionsEvents:function(){this.container.addEvents({"click:relay(.ig-btn)":this.handlers.prevent,"click:relay(.ig-prev)":this.handlers.prev,"click:relay(.ig-next)":this.handlers.next,"click:relay(.ig-play)":this.handlers.play,"click:relay(.ig-pause)":this.handlers.pause,"mouseover:relay(.ig-btn)":this.handlers.over,"mouseout:relay(.ig-btn)":this.handlers.out,"click:relay(.ig-img .sk-ig-clip-wrapper)":this.handlers.set_zoom})},prevent:function(t){t.stopPropagation()},play:function(t){this.is_playing=!0,this.is_paused=!1,this.onTransitionComplete(),t&&this.next(),this.runAutoplay()},pause:function(){this.is_playing=!1,this.is_paused=!0,this.stopAutoplay(),this.onTransitionComplete()},prev:function(){this.stopAutoplay(),this.transitions_manager.animateToPrevious(this.handlers.transition_complete),this.runAutoplay()},next:function(){this.stopAutoplay(),this.transitions_manager.animateToNext(this.handlers.transition_complete),this.runAutoplay()},onTransitionComplete:function(){var t=this.transitions_manager.getCurrentIndex();this.container.getElements(".ig-prev").toggleClass("ig-disabled",0==t&&0==this.options.loop),this.container.getElements(".ig-next").toggleClass("ig-disabled",this.transitions_manager.getLastIndex()==t&&0==this.options.loop),this.container.getElements(".ig-num1").set("text",t+1),this.container.getElements(".ig-play").toggleClass("sk-ig-liv-hide",this.is_playing),this.container.getElements(".ig-pause").toggleClass("sk-ig-liv-hide",!this.is_playing)},stopAutoplay:function(){this.handlers.autoplay=clearTimeout(this.handlers.autoplay),this.toggleZoom(!0,{},this.current_zoomed_image)},runAutoplay:function(){0==this.options.auto_play&&!this.is_playing||!this.options.delay||this.is_paused||(this.is_playing=!0,this.handlers.autoplay=this.next.delay(1e3*parseInt(this.options.delay,10),this))},onHoverNavButton:function(t,e,i){i.toggleClass("ig-over",t)},toggleZoom:function(t,e,i){if(this.options.zoom&&i&&!this.is_draging){var n=i.getElement("img"),s=i.retrieve("drag"),r=i.getParent(".ig-img").hasClass("sk-ig-liv-zoom")||t,a=n.get("data-width").toInt(),o=n.get("data-height").toInt(),l=i.getParent(".sk-ig-dimensions-wrapper").getSize();if(this.current_zoomed_image=null,!(l.x>a&&l.y>o)){if(!t&&(this.current_zoomed_image=i),i.getParent(".ig-img").toggleClass("sk-ig-liv-zoom",!r),n.setStyles({width:r?"":a+"px","max-width":"","max-height":""}).set("sizes",r?n.get("data-sizes"):""),r&&this.setImageWrapperSize(n),!s){var h=n.getSize();s=new Drag(n,{limit:{x:[l.x-h.x,0],y:[l.y-h.y,0]},modifiers:{x:l.x>a?"":"left",y:l.y>o?"":"top"},onDrag:this.handlers.drag,onComplete:this.handlers.complete}).detach(),i.store("drag",s)}s[r?"detach":"attach"]()}}},setDragState:function(t){this.is_draging=t},_hide:function(){!this.is_shown&&this.container.addClass("sk-ig-liv-hide"),this.container.getElements("img").setStyle("max-height",""),this.container.inject(this.placeholder)},onKeydown:function(t){switch(t.preventDefault(),t.key){case"esc":this.hide();break;case"left":this.prev();break;case"right":this.next()}},hockViewerEvents:function(){this.placeholder.getElement(".sk-ig-image-gallery").addEvent("click:relay(.ig-thumbs .sk-ig-open-viewer img, .ig-thumbs .sk-ig-open-viewer canvas)",this.handlers.show),this.container.addEvents({"click:relay(.ig-viewer-close)":this.handlers.hide,"click:relay(.ig-overlay)":this.handlers.hide})},refresh:function(t){this.setOptions(t),this.transitions_manager&&this.initTransitions(),this.onTransitionComplete(),this.transitions_manager.setTransition("fade"),this.transitions_manager.setupTransitionItems({timeout:parseInt(this.options.delay,10)})},show:function(t,e){this.is_shown=!0,SK.Singletons.env.get("admin_mode")&&!this.isEditMode()||(this.container.inject(document.body),this.refresh(this.options),window.addEvent("keydown",this.handlers.keydown),this.is_galllery_playing=this.options.display_instance.isPlaying(),this.options.display_instance.pause(),this.runAutoplay(),this.transitions_manager.gotoIndex(e.get("data-index").toInt()),this.onTransitionComplete(),this.container.removeClass("sk-ig-liv-hide"),this.handlers.show_with_delay=this.container.addClass.delay(0,this.container,["sk-ig-liv-animate"]),this.lazyLoadLargeViewer(),this.viewer_mask.setStyle("max-width",this.container.getElement(".ig-viewer-waypoint").getWidth()),this.setImageWrapperSize.delay(0,this))},setImageWrapperSize:function(t){t?t.setStyle("max-height",t.getParent(".sk-ig-dimensions-wrapper").getHeight()):this.container.getElements("img").each(this.setImageWrapperSize,this)},hide:function(){this.is_shown=!1,this.pause(),window.removeEvent("keydown",this.handlers.keydown),this.is_galllery_playing&&(this.options.display_instance.play(),this.is_galllery_playing=!1),this.container.removeClass("sk-ig-liv-animate"),this.viewer_mask.setStyle("max-width",""),this.handlers.hide_with_delay=this._hide.delay(this.animation_duration,this)},lazyLoadLargeViewer:function(){this.is_lazy_load_initialized||(this.options.lazy_load.initLazyLoad(this.viewer_mask.getElements(".sk-ig-clip-wrapper img"),{scroll_wrapper:this.viewer_mask,buffer_size:this.options.lazy_load_buffer}),this.is_lazy_load_initialized=!0)}});